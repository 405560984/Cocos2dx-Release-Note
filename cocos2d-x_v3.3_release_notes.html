<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Cocos2d-x v3.3 中文发布说明 | Cocos2d-x 版本发布说明</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="./cocos2d-x_v3.3_release_notes_en.html" />
    
    
    <link rel="prev" href="./cocos2d-x_v3.2_release_notes_en.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="gitbook/style.css">


        
    <div class="book" data-level="2.7" data-basepath="." data-revision="1435215748332">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="cocos2d-x_release_notes.html">
            
                
                    <a href="./cocos2d-x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Cocos2d-x 版本发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="cocos2d-x_v3.x_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Cocos2d-x v3.x 系列
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="cocos2d-x_v3.0_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.0_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Cocos2d-x v3.0 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="cocos2d-x_v3.0_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.0_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Cocos2d-x v3.0 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.3" data-path="cocos2d-x_v3.1_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.1_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                         Cocos2d-x v3.1 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.4" data-path="cocos2d-x_v3.1_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.1_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                         Cocos2d-x v3.1 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.5" data-path="cocos2d-x_v3.2_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.2_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                         Cocos2d-x v3.2 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.6" data-path="cocos2d-x_v3.2_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.2_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                         Cocos2d-x v3.2 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="2.7" data-path="cocos2d-x_v3.3_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.3_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                         Cocos2d-x v3.3 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.8" data-path="cocos2d-x_v3.3_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.3_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                         Cocos2d-x v3.3 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.9" data-path="cocos2d-x_v3.4_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.4_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                         Cocos2d-x v3.4 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.10" data-path="cocos2d-x_v3.4_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.4_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                         Cocos2d-x v3.4 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.11" data-path="cocos2d-x_v3.5_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.5_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.11.</b>
                        
                         Cocos2d-x v3.5 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.12" data-path="cocos2d-x_v3.5_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.5_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.12.</b>
                        
                         Cocos2d-x v3.5 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.13" data-path="cocos2d-x_v3.6_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.6_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.13.</b>
                        
                         Cocos2d-x v3.6 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.14" data-path="cocos2d-x_v3.6_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.6_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.14.</b>
                        
                         Cocos2d-x v3.6 英文发布说明
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="cocos2d-x_v4.x_release_notes.html">
            
                
                    <a href="./cocos2d-x_v4.x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Cocos2d-x v4.x 系列
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Cocos2d-x 版本发布说明</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_1">
                    
                        <h1 id="cocos2d-x-v33-">cocos2d-x v3.3 发布说明</h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>目录</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank">DocToc</a></em></p>
<ul>
<li><a href="#%E6%A6%82%E5%86%B5">概况</a></li>
<li><a href="#%E9%9C%80%E6%B1%82">需求</a><ul>
<li><a href="#%E7%8E%AF%E5%A2%83%E9%9C%80%E6%B1%82">环境需求</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E9%9C%80%E6%B1%82">编译需求</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C-testcpp">如何运行 TestCpp</a><ul>
<li><a href="#mac-osx-&amp;-ios">Mac OSX &amp; iOS</a></li>
<li><a href="#android">Android</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%A7%8B%E4%B8%80%E4%B8%AA%E6%96%B0%E6%B8%B8%E6%88%8F">如何开始一个新游戏</a></li>
</ul>
</li>
<li><a href="#v33">v3.3</a></li>
<li><a href="#v33rc2">v3.3rc2</a><ul>
<li><a href="#v33rc2%E4%BA%AE%E7%82%B9">v3.3rc2亮点</a></li>
<li><a href="#v33rc1%E8%AF%B4%E6%98%8E">v3.3rc1说明</a></li>
</ul>
</li>
<li><a href="#v33rc1">v3.3rc1</a><ul>
<li><a href="#v33rc1%E4%BA%AE%E7%82%B9">v3.3rc1亮点</a></li>
<li><a href="#v33rc0%E8%AF%B4%E6%98%8E">v3.3rc0说明</a></li>
</ul>
</li>
<li><a href="#v33rc0">v3.3rc0</a><ul>
<li><a href="#v33rc0%E4%BA%AE%E7%82%B9">v3.3rc0亮点</a></li>
<li><a href="#%E7%BB%86%E8%8A%82">细节</a><ul>
<li><a href="#%E5%85%89%E6%BA%90">光源</a></li>
<li><a href="#spine-runtime">Spine runtime</a></li>
<li><a href="#assetsmanagerex">AssetsManagerEx</a></li>
<li><a href="#applicationopenurl">Application::openURL</a></li>
<li><a href="#clippingrectanglenode">ClippingRectangleNode</a></li>
<li><a href="#facebook-%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81">Facebook 平台支持</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#v33beta0">v3.3beta0</a><ul>
<li><a href="#v33beta0%E4%BA%AE%E7%82%B9">v3.3beta0亮点</a></li>
<li><a href="#%E7%BB%86%E8%8A%82-1">细节</a><ul>
<li><a href="#billboard">BillBoard</a></li>
<li><a href="#triangles-command">Triangles command</a></li>
<li><a href="#webview">WebView</a></li>
<li><a href="#%E6%96%B0%E7%9A%84%E5%A3%B0%E9%9F%B3%E5%BC%95%E6%93%8E">新的声音引擎</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#v33alpha0">v3.3alpha0</a><ul>
<li><a href="#v33alpha0%E4%BA%AE%E7%82%B9">v3.3alpha0亮点</a></li>
<li><a href="#%E7%BB%86%E8%8A%82-2">细节</a><ul>
<li><a href="#camera">Camera</a></li>
<li><a href="#reskin">Reskin</a></li>
<li><a href="#attachment">Attachment</a></li>
<li><a href="#%E6%9B%B4%E5%A5%BD%E5%9C%B0%E6%94%AF%E6%8C%81fbx">更好地支持FBX</a></li>
<li><a href="#%E6%96%B0%E7%9A%84fbx-conv%E5%B7%A5%E5%85%B7">新的fbx-conv工具</a></li>
<li><a href="#aabb-obb-and-ray">AABB, OBB and Ray</a></li>
<li><a href="#uiscale9sprite">ui::Scale9Sprite</a></li>
<li><a href="#c11%E9%9A%8F%E6%9C%BA%E6%95%B0%E6%94%AF%E6%8C%81">c++11随机数支持</a></li>
<li><a href="#rendertexture%E4%BF%9D%E5%AD%98%E5%8A%9F%E8%83%BD">RenderTexture保存功能</a></li>
<li><a href="#primitive">Primitive</a></li>
<li><a href="#%E6%9B%B4%E6%96%B9%E4%BE%BF%E5%9C%B0%E8%AE%BE%E7%BD%AEgl%E4%B8%8A%E4%B8%8B%E6%96%87%E5%B1%9E%E6%80%A7">更方便地设置GL上下文属性</a></li>
<li><a href="#%E5%8F%AA%E7%95%992%E4%B8%AA%E5%BA%93">只留2个库</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="">概况</h1>
<ul>
<li>完整更新日记: <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.3/CHANGELOG" target="_blank">https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.3/CHANGELOG</a></li>
<li>v3.0 发布说明: <a href="https://github.com/fusijie/Cocos2dx-ReleaseNote-zh/blob/master/cocos2d-x_v3.0_release_notes.md" target="_blank">v3.0 Release Notes</a></li>
</ul>
<h1 id="">需求</h1>
<h2 id="">环境需求</h2>
<ul>
<li>Android 2.3 及以上</li>
<li>iOS 5.0 及以上</li>
<li>OS X 10.7 及以上</li>
<li>Windows 7 及以上</li>
<li>Windows Phone 8 及以上</li>
<li>Linux Ubuntu 14.04 及以上</li>
</ul>
<h2 id="">编译需求</h2>
<ul>
<li>Xcode 5.1 及以上 (for iOS or Mac)</li>
<li>gcc 4.9 及以上 (for Linux)</li>
<li>ndk-r10c (for Android)</li>
<li>Visual Studio 2012 及以上 (for Windows (win32))</li>
<li>Visual Studio 2012 及以上 (for Windows Phone 8)</li>
</ul>
<h2 id="-testcpp">如何运行 TestCpp</h2>
<h3 id="mac-osx--ios">Mac OSX &amp; iOS</h3>
<ul>
<li>进入 <code>cocos2d-x/build</code> 文件夹, 打开 <code>cocos2d_test.xcodeproj</code></li>
<li>在 Xcode 的 scheme toolbar 选择 <code>iOS</code> 或者 <code>OS X</code> 平台</li>
<li>点击 <code>run</code> 按钮</li>
</ul>
<h3 id="android">Android</h3>
<p>你可以运行一下示例...</p>
<p><strong>使用命令行：</strong></p>
<pre><code>$ cd cocos2d-x
$ ./setup.py
$ cd build
$ ./android-build.py cpp-empty-test -p 10
$ adb install cocos2d-x/tests/cpp-empty-test/proj.android/bin/CppEmptyTest-debug.apk
</code></pre><p>然后点击安卓设备上的程序运行测试例，<code>-p</code> 指定了 Android API 等级，cocos2d-x 支持 level10 以上。</p>
<p><strong>使用 Eclipse:</strong></p>
<pre><code>$ cd cocos2d-x
$ ./setup.py
$ cd build
$ ./android-build.py cpp-empty-test -p 10
</code></pre><p>然后</p>
<ul>
<li>把 cocos2d-x Android 项目导入 Eclipse 中，导入的路径是 <code>cocos/platform/android</code></li>
<li>把 <code>cpp-empty-test</code> Android 项目导入 Eclipse 中，导入的路径是 <code>tests/cpp-empty-test/proj.android</code></li>
<li>编译 <code>cpp-empty-test</code> Android 项目，然后运行即可</li>
</ul>
<h3 id="windows">Windows</h3>
<ul>
<li>进入 <code>cocos2d-x/build</code> 目录, 然后打开 <code>cocos2d-win32.vs2012.sln</code> 文件</li>
<li>选择 <code>cpp-empty-test</code> 作为启动项</li>
<li>点击运行按钮</li>
</ul>
<h3 id="linux">Linux</h3>
<pre><code>$ cd cocos2d-x/build
$ ./install-deps-linux.sh
$ cd ../..
</code></pre><p>然后</p>
<pre><code>$ mkdir build
$ cd build
$ cmake ../cocos2d-x
$ make -j4
</code></pre><p>运行</p>
<pre><code>$ cd bin/cpp-empty-test
$ ./cpp-empty-test
</code></pre><h2 id="">如何开始一个新游戏</h2>
<p>请参考: <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.3/README.md" target="_blank">ReadMe</a></p>
<h1 id="v33">v3.3</h1>
<p>从v3.3rc2开始只是修复了一些bug。</p>
<h1 id="v33rc2">v3.3rc2</h1>
<h2 id="v33rc2">v3.3rc2亮点</h2>
<ul>
<li>支持android arm64位架构，所有的测试例在Nexus 9正常运行</li>
<li>Cocos Studio Reader: 使用 <a href="https://github.com/google/flatbuffers" target="_blank">FlatBuffer</a> 替代 <a href="https://github.com/google/protobuf" target="_blank">Protobuffer</a> </li>
</ul>
<h2 id="v33rc1">v3.3rc1说明</h2>
<p><strong>android</strong></p>
<p>需要使用Android NDK-r10c编译，具体细节请参考此链接：</p>
<p><a href="http://discuss.cocos2d-x.org/t/build-android-base-on-ndk-r10c/18543" target="_blank">http://discuss.cocos2d-x.org/t/build-android-base-on-ndk-r10c/18543</a>.</p>
<h1 id="v33rc1">v3.3rc1</h1>
<h2 id="v33rc1">v3.3rc1亮点</h2>
<ul>
<li>WP8: 添加 Win8.1 universal app 支持</li>
<li>修复了一些bug.</li>
</ul>
<h2 id="v33rc0">v3.3rc0说明</h2>
<p><strong>wp8</strong></p>
<p>对于WP8，你需要使用<code>VS2013 with update 3</code>来使用<code>Cocos2dShaderCompiler</code>编译预编译shader。</p>
<p><strong>lua</strong></p>
<p>当创建一个新的lua项目的时候，所有的内部lua文件会被拷贝到<code>src/cocos</code>目录。我们添加了<code>cocos/init.lua</code>文件来加载所有这些内部lua文件。你不必自己手动加载这些lua文件，因为<code>cocos/init.lua</code>是由引擎默认加载的。所以，如果你想升级旧引擎的话需要在你的代码中移除所有的这些代码：</p>
<ul>
<li>require &quot;Cocos2d&quot;</li>
<li>require &quot;Cocos2dConstants&quot; </li>
<li>require &quot;bitExtend&quot;</li>
<li>require &quot;DrawPrimitives&quot; </li>
<li>require &quot;extern&quot;</li>
<li>require &quot;json&quot;</li>
<li>require &quot;Opengl&quot;</li>
<li>require &quot;OpenglConstants&quot; </li>
<li>require &quot;CCBReaderLoad&quot; </li>
<li>require &quot;AudioEngine&quot;</li>
<li>require “CocoStudio”</li>
<li>require “StudioConstants”</li>
<li>require “ControllerConstants” </li>
<li>require “ExtensionConstants”</li>
<li>require “NetworkConstants”</li>
<li>require “GuiConstants”</li>
<li>require “experimentalUIConstants” </li>
</ul>
<p><code>luaj</code>和<code>luaoc</code>比较特殊，他们不能在<code>cocos/init.lua</code>中被加载，因为他们会返回一个对象用于代码中，所以你需要像下面这样替换一下代码：</p>
<ul>
<li>require &quot;luaj&quot; -&gt; require &quot;cocos.cocos2d.luaj&quot;</li>
<li>require &quot;luaoc&quot; -&gt; require &quot;cocos.cocos2d.luaoc&quot;</li>
</ul>
<p>所有弃用API的lua文件默认不被加载，如果你需要使用这些弃用的API，你应该去掉<code>src/main.lua</code>中注释的这一行：</p>
<pre><code>-- 去掉这行注释，用于使用弃用的API
-- CC_USE_DEPRECATED_API = true 
require &quot;cocos.init&quot;
</code></pre><p><code>cc.EditBox</code> 和 <code>cc.Scale9Sprite</code> 已经被弃用了, 你应该使用 <code>ccui.EditBox</code> 和 <code>ccui.Scale9Sprite</code>。</p>
<p><code>ccs.NodeReader</code> 被移除了因为native类 <code>cocostudio::timeline::NodeReader</code> 已经被移除了。在v3.3rc0中，你可以使用 <code>cc.CSLoader</code> 替代。</p>
<p><code>sp.Skeleton</code> 被移除了，因为升级完spine runtime后native类 <code>spine::Skeleton</code> 已经被移除了。</p>
<p><code>sp.SkeletonAnimation</code> 的 <code>registerSpineEventHandler</code> 变更了：</p>
<ul>
<li>registerSpineEventHandler(fucntion)  -&gt; registerSpineEventHandler(funtion, eventType)</li>
</ul>
<h1 id="v33rc0">v3.3rc0</h1>
<h2 id="v33rc0">v3.3rc0亮点</h2>
<ul>
<li>3d：添加光源支持：包含方向光，点光，聚光和环境光</li>
<li>New audio: 更多平台支持(Mac OS X and Windows)</li>
<li>Spine runtime: 升级到 v2.0.18</li>
<li>Application: 添加 openURL()</li>
<li>添加 <code>AssetsManagerEx</code>，这是一个 <code>AssetsManager</code>的增强版本</li>
<li>TileMap: 支持staggered tile map</li>
<li>添加 <code>ClippingRectangleNode</code>，这是一个更高效的矩形裁剪</li>
<li>Node: schedule/unschedule lambda 函数</li>
<li>iOS和Android的Facebook平台支持，全特性添加，但是API需要Facebook的伙伴打磨。</li>
</ul>
<h2 id="">细节</h2>
<h3 id="">光源</h3>
<p>为了使3d对象看起来更加真实，我们在这个版本中添加了光源。cocos2d-x支持4种类型的光源：方向光，点光，聚光和环境光。</p>
<p><code>方向光</code>代表着一个非常遥远的光源（比如太阳或者月亮）。光线从天空中的每一个点定向平行地投射下来，通常用于模拟太阳光。</p>
<p>以下代码用于添加一个方向光到场景中，</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> directionalLight = DirectionLight::create(Vec3(-<span class="hljs-number">1.0f</span>, -<span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>), Color3B(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>));
addChild(directionalLight);
</code></pre>
<p>光是默认打开的。也可以用如下代码关闭，</p>
<pre><code class="lang-c++">directionalLight-&gt;setEnabled(<span class="hljs-keyword">false</span>);
</code></pre>
<p>你也可以给光设置一个标识。</p>
<pre><code class="lang-c++">directionalLight-&gt;setLightFlag(LightFlag::LIGHT0);
</code></pre>
<p>如果某个3d精灵的光掩码和光的标识进行与操作后不等于0，那么这个3d精灵就会受光影响。</p>
<p><code>点光</code>代表着从一个3D空间向外投射光线的单一无限小的点。通常用于模拟全向光源。</p>
<p><code>聚光</code>代表着一个空间中可以发射出一个锥形光场的点。它可以用来模拟台灯，天花板上锥形灯光等等。注意<code>聚光</code>会更消耗GPU时间。</p>
<p><code>环境光</code>在每一个方向上投下柔和的灯光。</p>
<p>需要注意的是我们使用了前向渲染方法，光源的数量会影响性能。你可以在配置文件中设置着色器支持的最大光源数。</p>
<pre><code class="lang-c++">&lt;key&gt;cocos2d.x.3d.max_dir_light_in_shader&lt;/key&gt;
&lt;integer&gt;1&lt;/integer&gt;
&lt;key&gt;cocos2d.x.3d.max_point_light_in_shader&lt;/key&gt;
&lt;integer&gt;1&lt;/integer&gt;
&lt;key&gt;cocos2d.x.3d.max_spot_light_in_shader&lt;/key&gt;
&lt;integer&gt;1&lt;/integer&gt;
</code></pre>
<h3 id="spine-runtime">Spine runtime</h3>
<p>Spine runtime升级到最新版本<code>v2.0.18</code>。这个版本支持<code>Free-Form-Deformation(FFD)</code>，它允许meshes拉伸，挤压，混合，弹跳，这是使用矩形图片所不允许的。</p>
<p><code>Spine runtime 已经升级了它的授权许可，只允许引擎使用未修改的版本，即使有bug也一样。所以童鞋们就不要发spine runtime的pull request了，我们不能合并。</code></p>
<p>请参考<code>tests/cpp-tests/Classes/SpineTest/SpineTest.cpp</code>使用。</p>
<h3 id="assetsmanagerex">AssetsManagerEx</h3>
<p><code>AssetsMangerEx</code> 是 <code>AssetsManager</code>的增强版本。 相比于 <code>AssetsManager</code>，使用 <code>AssetsManagerEx</code> 有一些优点：</p>
<ul>
<li>支持使用清单文件进行包的复杂更新</li>
<li>支持多线程下载</li>
<li>支持断点续传</li>
</ul>
<p>更多细节请参考<a href="http://cocos2d-x.org/wiki/Assets_manager" target="_blank">这个文档</a>。</p>
<h3 id="applicationopenurl">Application::openURL</h3>
<p>因为iOS上<code>UIApplication</code>有一个函数名叫<code>openURL</code>，所以我们也往Application中添加了这个函数，你可以使用这个函数来打开一个url。</p>
<pre><code class="lang-c++">Application::getInstance()-&gt;openURL(<span class="hljs-string">"http://www.cocos2d-x.org/"</span>);
</code></pre>
<h3 id="clippingrectanglenode">ClippingRectangleNode</h3>
<p><code>ClippingRectangleNode</code>是一个<code>ClippingNode</code>的轻量版本。 相比于 <code>ClippingNode</code>, 有一些优点和缺点:</p>
<ul>
<li><p>优点</p>
<ul>
<li>它不依赖于stencil buffer，这意味着它可以在更多的安卓设备上运行</li>
<li>性能更好</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>只能用于裁剪矩形区域</li>
</ul>
</li>
</ul>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> clipper = ClippingRectangleNode::create();
clipper-&gt;setClippingRegion(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>);
<span class="hljs-keyword">this</span>-&gt;addChild(clipper);

<span class="hljs-keyword">auto</span> content = Sprite::create(<span class="hljs-string">"MyPicture.png"</span>);
...
clipper-&gt;addChild(content);
</code></pre>
<h3 id="facebook-">Facebook 平台支持</h3>
<p>所有的特性都添加了，但是API需要Facebook的伙伴打磨。<code>plugin</code>中有一个测试例。</p>
<p>运行测试例的步骤：</p>
<ul>
<li>打开 <code>plugin/pluing-x_ios.xcworkspace</code></li>
<li>选择 <code>HelloPlugins</code> 运行</li>
<li>有两项： <code>Test Facebook User</code> 和 <code>Test Facebook Share</code>。</li>
</ul>
<p>更多细节你可以参考 <a href="http://www.cocos2d-x.org/wiki/Integrate_the_Facebook_SDK_for_Cocos2d-x" target="_blank">这个文档</a>。</p>
<h1 id="v33beta0">v3.3beta0</h1>
<h2 id="v33beta0">v3.3beta0亮点</h2>
<ul>
<li>3d: <code>BillBoard</code></li>
<li>audio: iOS和Android添加了新的声音引擎</li>
<li>DrawNode: 添加了和<code>DrawPrimitive</code>一样的功能，同时<code>DrawPrimitive</code>标识为弃用</li>
<li>Renderer: 添加了<code>triangle command</code></li>
<li>UI: iOS和Android添加了<code>WebView</code></li>
<li>添加了一些小的特性，修复了部分bug</li>
</ul>
<h2 id="">细节</h2>
<h3 id="billboard">BillBoard</h3>
<p><code>BillBoard</code>是一个一直朝向摄像机的矩形。这在3D世界中是很有用的。比如一般会使用它来创建赛车游戏中的树。它看起来会比较真实，但相对于3D的树来说，它消耗的性能比较少。</p>
<p><code>BillBoard</code>从Sprite中继承下来，因为它也支持动画。这是一个创建Billboard的示例。</p>
<pre><code class="lang-c++"><span class="hljs-comment">//通过.png创建一个billboard</span>
<span class="hljs-keyword">auto</span> billboard = BillBoard::create(<span class="hljs-string">"Images/Icon.png"</span>);
addChild(billboard);

<span class="hljs-comment">//创建一个摄像机来对准这个billboard。否则，它会被默认的摄像机看见</span>
<span class="hljs-keyword">auto</span> camera = Camera::createPerspective(<span class="hljs-number">60</span>, (GLfloat)s.width/s.height, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>);
camera-&gt;setCameraFlag(CameraFlag::CAMERA_USER1);
addChild(camera); <span class="hljs-comment">//添加camera</span>

<span class="hljs-comment">//这个billboard只被设置了CameraFlag::CAMERA_USER1标识的摄像机看见</span>
billboard-&gt;setCameraMask((<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">short</span>)CameraFlag::CAMERA_USER1);
</code></pre>
<h3 id="triangles-command">Triangles command</h3>
<p>通过引入<code>TrianglesCommand</code>增强了自动批处理特性，<code>Triangles</code>的渲染可以被自动批处理。现在如果我们有任意可以由<code>Triangles</code>渲染的东西，我们可以使用<code>TrianglesCommand</code>或者它的子类来利用自动批处理特性，从而获得性能上的提升。<code>QuadCommand</code>用来渲染<code>Quad</code>，这就是一个从<code>TrianglesCommand</code>继承下来的很好的例子。</p>
<p>使用Triangle Command是非常简单的：</p>
<pre><code>    Triangles trs{verts, indices, vertCount, indexCount};
    command-&gt;init(globalZOrder,textureID, glProgramState,blend,trs,matrix);
    renderer-&gt;addCommand(command);
</code></pre><p>为了提高性能，<code>Triangles</code>会维护一个待渲染的定点和索引数据的弱引用，就像是<code>QuadCommand</code>那样。在<code>Renderer</code>执行<code>Command</code>之前，开发者不能释放任何的渲染数据。</p>
<h3 id="webview">WebView</h3>
<p>WebView是一个允许你在Cocos2d-x内部显示web内容的控件。目前我们只提供了iOS和Android的实现，将来会有更多的平台会被添加。</p>
<p>这个类在<code>cocos2d::ui::experimental</code>命名空间下。</p>
<p>正如我们之前声明的<code>experimental</code>命名空间那样，<code>experimental</code>命名空间并不意味着这个控件是不完整的，只是因为缺少了全平台的支持而已。所以，尽管在你的游戏中使用吧。</p>
<p>如果想要在WebView中显示谷歌网站，我们可以简单地这么写：</p>
<pre><code class="lang-cpp">    _webView = cocos2d::experimental::ui::WebView::create();
    _webView-&gt;setPosition(winSize/<span class="hljs-number">2</span>);
    _webView-&gt;setContentSize(winSize * <span class="hljs-number">0.5</span>);
    _webView-&gt;loadUrl(<span class="hljs-string">"http://www.google.com"</span>);
    _webView-&gt;setScalesPageToFit(<span class="hljs-keyword">true</span>);
</code></pre>
<p><code>setscalesPageToFit</code>方法将会让WebView的内容自适应它的大小。</p>
<p>我们也可以给WebView设置一些回调：</p>
<pre><code class="lang-cpp">    <span class="hljs-comment">//我们可以校验URL来决定是否继续</span>
    _webView-&gt;shouldStartLoading = CC_CALLBACK_2(WebViewTest::onWebViewShouldStartLoading, <span class="hljs-keyword">this</span>);
    <span class="hljs-comment">//网页完成加载后回调</span>
    _webView-&gt;didFinishLoading = CC_CALLBACK_2(WebViewTest::onWebViewDidFinishLoading, <span class="hljs-keyword">this</span>);
    <span class="hljs-comment">//网页加载失败后回调</span>
    _webView-&gt;didFailLoading = CC_CALLBACK_2(WebViewTest::onWebViewDidFailLoading, <span class="hljs-keyword">this</span>);
</code></pre>
<p>更完整的测试例，请参考<a href="https://github.com/cocos2d/cocos2d-x/blob/v3/tests/cpp-tests/Classes/UITest/CocoStudioGUITest/UIWebViewTest/UIWebViewTest.cpp" target="_blank">WebViewTest</a></p>
<h3 id="">新的声音引擎</h3>
<p>相比于旧的声音引擎，新的声音引擎更加强大，同时它和旧的也不兼容。当新的声音引擎全平台实现的时候我们将会弃用旧的。现在仅支持iOS和Android平台，我们计划在v3.4的时候完成它。</p>
<p>哪些东西在新的声音引擎中增强了：</p>
<ul>
<li>可以播放超过一个背景音乐</li>
<li>当一个声音（音乐或者音效）结束的时候可以有一个回调</li>
<li>可以获取一个声音的持续时间</li>
<li>可以获取/设置一个音乐的播放位置</li>
<li>播放的时候可以修改循环状态</li>
</ul>
<p>和旧的声音引擎相比有什么不同：</p>
<ul>
<li>所有的函数都是静态的，因此你可以更容易地调用它的函数，比如：<code>Audio::play2d()</code></li>
<li>不管是音乐还是音效，只有一个调用方法<code>play2d()</code></li>
<li>应该使用<code>Audio::getState()</code>来确定一个声音是在播放还是暂停</li>
<li>在C++中它的类名是<code>cocos2d::experimental::AudioEngine</code>，在lua-binding中它的模块名是<code>ccexp.AudioEngine</code></li>
<li>没有预加载功能，你可以立即播放一个声音</li>
</ul>
<p>更完整的测试例，请参考 <code>tests/cpp-tests/Classes/NewAudioEngineTest/NewAudioEngineTest.cpp</code>.</p>
<h1 id="v33alpha0">v3.3alpha0</h1>
<h2 id="v33alpha0">v3.3alpha0亮点</h2>
<ul>
<li>3d: <code>Camera</code>, <code>Reskin</code>, <code>Attachment</code>, <code>更好地支持FBX</code>, <code>新的fbx-conv工具</code>, <code>AABB</code>, <code>OBB</code> 和 <code>Ray</code></li>
<li>ui: 添加 <code>Scale9Sprite</code></li>
<li>FileUitls: 添加 <code>isDirectoryExist()</code>, <code>createDirectory()</code>, <code>removeDirectory()</code>, <code>removeFile()</code>, <code>renameFile()</code> 和 <code>getFileSize()</code></li>
<li>Device: 在iOS和Android上添加 <code>setKeepScreenOn()</code></li>
<li>添加C++11随机数支持</li>
<li>RenderTexture: 为<code>saveToFile()</code>添加回调</li>
<li>Primitive: 支持点，线，三角形的渲染</li>
<li>SpriteFrameCache: 支持从plist文件中加载数据内容</li>
<li>为各平台添加了一致性接口来设置GL上下文属性</li>
<li>只保留了2个库，一个是C++代码，一个是lua-binding</li>
<li>其他功能添加以及bug修复</li>
</ul>
<h2 id="">细节</h2>
<h3 id="camera">Camera</h3>
<p>这个版本的camera比之前的版本更加的强大。你可以将它作为一个子节点添加到任意的地方。如果你想让节点可以被camera访问，Node的掩码必须包含Camera的标识：</p>
<pre><code class="lang-c++"><span class="hljs-comment">// 让sprite可以被camera访问</span>
<span class="hljs-keyword">auto</span> sprite = Sprite::create(<span class="hljs-string">"myFile.png"</span>);
sprite-&gt;setCameraMask(CameraFlag::USER1);
<span class="hljs-keyword">auto</span> camera = Camera::createPerspective(<span class="hljs-number">60</span>, winSize.width/winSize.height, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>);
camera-&gt;setCameraFlag(CameraFlag::USER1);
scene-&gt;addChild(camera);
</code></pre>
<p>如果你有很多节点需要被camera访问，这里有一种简便的方法：</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> layer = Layer::create();
<span class="hljs-keyword">auto</span> sprite1 = Sprite::create();
<span class="hljs-keyword">auto</span> sprite2 = Sprite::create();
layer-&gt;addChild(sprite1);
layer-&gt;addChild(sprite2);
<span class="hljs-comment">//它将会为所有的子节点设置camera的掩码</span>
layer-&gt;setCameraMask(CameraFlg::USER1); 

<span class="hljs-keyword">auto</span> camera = Camera::createPerspective();
camera-&gt;setCameraFlag(CameraFlag::USER1);
scene-&gt;addChild(camera);
</code></pre>
<p>更完整的测试例，请参考 <code>tests/cpp-tests/res/Camera3DTest/Camera3DTest.cpp</code>。</p>
<h3 id="reskin">Reskin</h3>
<p>这是一个很给力的特性，用户可以改变角色的外观。</p>
<p>举个例子，有一个模型叫girl.c3b，模型有两件外套，coat0和coat1。那么，角色的外套可以这样改变：</p>
<pre><code class="lang-c++"><span class="hljs-comment">//从文件中加载girl</span>
<span class="hljs-keyword">auto</span> sprite3d = Sprite3D::create(<span class="hljs-string">"girl.c3b"</span>);
<span class="hljs-comment">//获取名为coat0的mesh</span>
<span class="hljs-keyword">auto</span> mesh0 = sprite3d-&gt;getMeshByName(<span class="hljs-string">"coat0"</span>);
<span class="hljs-comment">//如果你愿意的话可以修改mesh的纹理</span>
mesh0-&gt;setTexture(<span class="hljs-string">"cloth.png"</span>);
<span class="hljs-comment">//当然你也可以修改这个mesh的可见性</span>
mesh0-&gt;setVisible(<span class="hljs-keyword">true</span>);
<span class="hljs-comment">//隐藏coat1</span>
<span class="hljs-keyword">auto</span> mesh1 = sprite3d-&gt;getMeshByName(<span class="hljs-string">"coat1"</span>);
mesh1-&gt;setVisible(<span class="hljs-keyword">false</span>);
</code></pre>
<p>更完整的测试例，请参考 <code>tests/cpp-tests/Classes/Spret3DTest/Sprite3DTest.cpp</code></p>
<h3 id="attachment">Attachment</h3>
<p>允许附加一个节点到一个骨骼</p>
<p>用法，</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> sprite = Sprite3D::create(<span class="hljs-string">"girl.c3b"</span>);
<span class="hljs-keyword">auto</span> weapon = Sprite::create(<span class="hljs-string">"weapon.c3b"</span>);
<span class="hljs-keyword">auto</span> attachNode = sprite-&gt;getAttachNode(<span class="hljs-string">"left_hand"</span>);
attachNode-&gt;addChild(weapon);
</code></pre>
<p>更完整的测试例，请参考 <code>tests/cpp-tests/Classes/Spret3DTest/Sprite3DTest.cpp</code></p>
<h3 id="fbx">更好地支持FBX</h3>
<p>支持多个mesh
支持多个material
每个mesh绑定的骨骼数限制在40个以内。但是FBX模型可以包含多个mesh。所以模型可以包含更多的骨骼。</p>
<h3 id="fbx-conv">新的fbx-conv工具</h3>
<p>可以导出包含多个mesh多个material的复杂模型。</p>
<h3 id="aabb-obb-and-ray">AABB, OBB and Ray</h3>
<p>AABB 意思是 Axis Aligned Bounding Box
OBB 意思是 Oriented Bounding Box
Ray 有一个原点和方向</p>
<p>每一个Sprite3D或者Mesh都有自己的AABB。
AABB 和 OBB可以被Ray选中。</p>
<p>用法，</p>
<pre><code class="lang-c++"><span class="hljs-comment">//从Camera获取Ray</span>
Vec3 nearP(location.x, location.y, -<span class="hljs-number">1.0f</span>), farP(location.x, location.y, <span class="hljs-number">1.0f</span>); 
<span class="hljs-keyword">auto</span> size = Director::getInstance()-&gt;getWinSize();
camera-&gt;unproject(size, &amp;nearP, &amp;nearP);
camera-&gt;unproject(size, &amp;farP, &amp;farP);
ray._origin = nearP;
ray._direction = farP - nearP;
ray.intersects(sprite3d-&gt;getAABB( ) );
</code></pre>
<p>更完整的测试例，请参考 <code>tests/cpp-tests/Classes/Spret3DTest/Sprite3DTest.cpp</code></p>
<h3 id="uiscale9sprite">ui::Scale9Sprite</h3>
<p>我们在ui模块下实现了一个新的Scale9Sprite类。它的内部实现比之前的Scale9Sprite更为简洁，功能也更为强大。
重新实现这个类的主要的原因是，Scale9Sprite在UI模块被大量使用。现在UI模块不再依赖于extension模块。
通过采用全新的UI::Scale9Sprite，很多部件类内部的代码更加简洁，优雅。</p>
<p>We could manually toggle &quot;slice 9&quot; feature by one function call:
我们可以通过一个函数来手动切换“slice 9”的特性。</p>
<pre><code class="lang-c++"><span class="hljs-comment">//ui::Scale9Sprite默认是开启“slice 9”</span>
<span class="hljs-keyword">auto</span> sprite = ui::Scale9Sprite::create(<span class="hljs-string">"foo.png"</span>);
sprite-&gt;setScale9Enabled(<span class="hljs-keyword">false</span>);
</code></pre>
<p>现在也支持翻转了，</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> sprite = ui::Scale9Sprite::create(<span class="hljs-string">"bar.png"</span>);
sprite-&gt;setFlippedX(<span class="hljs-keyword">true</span>);
sprite-&gt;setFlippedY(<span class="hljs-keyword">false</span>);
</code></pre>
<p>因为ui::Scale9Sprite是一个节点而不是Sprite，所以你不能将它加入批处理节点中，如果你想要在sprite的内部去做一些动作，你可以调用<code>sprite-&gt;getSprite()</code>来访问它。</p>
<p>更完整的测试例，请参考 <code>tests/cpp-tests/Classes/UITests/CocostudioGUITest/UIScale9SpriteTest.cpp</code></p>
<h3 id="c11">c++11随机数支持</h3>
<p>因为<code>rand()</code>不好用(参考<a href="http://c-faq.com/lib/randrange.html" target="_blank">这个文档</a>),我们使用C++11随机数库来生成一个随机数，同时提供了一个函数供调用：</p>
<pre><code class="lang-c++"><span class="hljs-keyword">int</span> randInt = cocos2d::random(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
<span class="hljs-keyword">float</span> randFloat = cocos2d::random(<span class="hljs-number">1.f</span>, <span class="hljs-number">10.f</span>);
</code></pre>
<h3 id="rendertexture">RenderTexture保存功能</h3>
<p><code>RenderTexture::saveToFile()</code>函数返回的时候后不再保存rendertexture，因为它只是发送render command到renderer而已。render command执行的时候文件才会保存。如果你想用保存文件来做一些事情的时候会很不方便，所以我们在<code>RenderTexture::saveToFile()</code>添加了一个参数用来设置文件保存时的回调函数。</p>
<pre><code class="lang-c++">renderTexture-&gt;begin();
...
renderTexture-&gt;end();

renderTexture-&gt;saveToFile(<span class="hljs-string">"myFile.png"</span>, <span class="hljs-keyword">true</span>, callback);
</code></pre>
<h3 id="primitive">Primitive</h3>
<p><code>Primitive</code> 被添加用来支持 <code>Points</code>,<code>Lines</code>,<code>Triangles</code> 的渲染。之前，如果我们想要画一个自定义的几何体（球面，线），只能通过使用<code>CustomCommand</code>。现在，只需要创建一个Primitive，设置数据，然后使用相应的<code>PrimitiveCommand</code>来画这个Primitive。</p>
<p>这里有一个简单的在<code>Sprite</code>中渲染一个四边形的示例。</p>
<ol>
<li><p>创建 verexBuffer</p>
<pre><code class="lang-c++"> <span class="hljs-keyword">auto</span> vertexBuffer = VerexBuffer::create(<span class="hljs-keyword">sizeof</span>(V3F_C4B_T2F), <span class="hljs-number">4</span>);
 vertexBuffer-&gt;updateVertices(&amp;_quad, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>);
</code></pre>
</li>
<li><p>创建 vertexData</p>
<pre><code class="lang-c++"> <span class="hljs-keyword">auto</span> vertexData = VertexData::create();
 vertexData-&gt;addStream(vertexBuffer, VertexStreamAttribute(<span class="hljs-number">0</span>, VERTEX_ATTRIB_POSITION, GL_FLOAT, <span class="hljs-number">3</span>, fasle));
 vertexData-&gt;addStream(vertexBuffer, VertexStreamAttribute(<span class="hljs-number">12</span>, VERTEX_ATTRIB_COLOR, GL_UNSIGNED_BTYE, <span class="hljs-number">4</span>, <span class="hljs-keyword">true</span>));
 vertexData-&gt;addStream(vertexBuffer, VertexStreamAttribute(<span class="hljs-number">16</span>, VERTEX_ATTRIB_TEX_COORD, GL_FLOAT, <span class="hljs-number">2</span>, fasle));
</code></pre>
</li>
<li><p>创建 IndexBuffer</p>
<pre><code class="lang-c++"> <span class="hljs-keyword">auto</span> indexBuffer = IndexBuffer::create(IndexType::INDEX_TYPE_SHORT_16, <span class="hljs-number">6</span>);
 <span class="hljs-keyword">short</span> indices[<span class="hljs-number">6</span>] = {<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>};
 indexBuffer-&gt;updateIndices(indices,<span class="hljs-number">6</span>, <span class="hljs-number">0</span>);
</code></pre>
</li>
<li><p>创建 primitive</p>
<pre><code class="lang-c++"> <span class="hljs-keyword">auto</span> primitve = Primitive::create(vertexData, indexBuffer, GL_TRIANGLES);
 primitive-&gt;setStart(<span class="hljs-number">0</span>);
 primitive-&gt;setCount(<span class="hljs-number">6</span>);
</code></pre>
</li>
<li><p>添加 command 到 renderer</p>
<pre><code class="lang-c++"> _command-&gt;init(globalZorder,textureID, glprogramState, blend, primitve, modelViewMatrix);
 renderer-&gt;addCommand(&amp;_command);
</code></pre>
</li>
</ol>
<p>Primitive 支持3种类型的primitives（POINTS, LINES, TRIANGLES），vertex 和 index sharing, multiple streams。它有一些约束条件：</p>
<p>1.顶点和索引缓冲器的大小是固定的，这意味着数据必须预先进行分配。
2.不支持批处理。</p>
<h3 id="gl">更方便地设置GL上下文属性</h3>
<p>现在你可以通过重写<code>Application::initGLContextAttrs()</code>来设置GL上下文属性，然后在里面设置GL上下文属性。</p>
<pre><code class="lang-c++"><span class="hljs-keyword">void</span> AppDelegate::initGLContextAttrs()
{
    <span class="hljs-comment">// r:8 g:8 a:8 depth:24 stencil:8</span>
    GLContextAttrs glContextAttrs = {<span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">24</span>, <span class="hljs-number">8</span>};
    GLView::setGLContextAttrs(glContextAttrs);
}
</code></pre>
<p>现在仅支持设置<code>r</code>，<code>g</code>，<code>b</code>，<code>a</code>，<code>depth buffer</code>和<code>stencil buffer</code>。如果有需要的话我们会添加更多的支持。</p>
<h3 id="2">只留2个库</h3>
<p>现在只留下2个库：一个是对于所有C++代码的，另一个是对于lua_bindings代码。</p>
<p>如果你使用C++进行开发，你只需链接<code>libcocos2d</code>。<code>libcocos2d</code>包含所有的C++代码：</p>
<ul>
<li>cocos2d(包含2d和3d)</li>
<li>network</li>
<li>cocosstudio</li>
<li>ui</li>
<li>cocosbuilder</li>
<li>spine</li>
<li>chipmunk</li>
<li>box2d</li>
<li>...</li>
</ul>
<p>未使用的代码会由链接器自动剥离。</p>
<p>如果你使用lua进行开发，你应该链接<code>libcocos2d</code>和<code>libluacocos2d</code>。如果不需要某些模块的话，你可以在<code>lua_module_register.h</code>中注释掉这些代码。</p>
<pre><code class="lang-c++"><span class="hljs-keyword">int</span> lua_module_register(lua_State* L)
{
    register_cocosdenshion_module(L); <span class="hljs-comment">// 注释此行以移除 cocosdenshion</span>
    register_network_module(L);       <span class="hljs-comment">// 注释此行以移除 network</span>
    register_cocosbuilder_module(L);  <span class="hljs-comment">// 注释此行以移除 cocosbuilder</span>
    register_cocostudio_module(L);    <span class="hljs-comment">// 注释此行以移除 cocostudio</span>
    register_extension_module(L);     <span class="hljs-comment">// 注释此行以移除 extension</span>
    register_ui_moudle(L);            <span class="hljs-comment">// 注释此行以移除 ui</span>
    register_spine_module(L);         <span class="hljs-comment">// 注释此行以移除 spine</span>
    register_cocos3d_module(L);       <span class="hljs-comment">// 注释此行以移除 3d</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./cocos2d-x_v3.2_release_notes_en.html" class="navigation navigation-prev " aria-label="Previous page: Cocos2d-x v3.2 英文发布说明"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./cocos2d-x_v3.3_release_notes_en.html" class="navigation navigation-next " aria-label="Next page: Cocos2d-x v3.3 英文发布说明"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"disqus":{"shortName":"Cocos2d-x"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
