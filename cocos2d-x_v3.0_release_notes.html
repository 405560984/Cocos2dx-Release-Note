<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Cocos2d-x v3.0 中文发布说明 | Cocos2d-x 版本发布说明</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="./cocos2d-x_v3.0_release_notes_en.html" />
    
    
    <link rel="prev" href="./cocos2d-x_v3.x_release_notes.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="gitbook/style.css">


        
    <div class="book" data-level="2.1" data-basepath="." data-revision="1435215748332">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="cocos2d-x_release_notes.html">
            
                
                    <a href="./cocos2d-x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Cocos2d-x 版本发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="cocos2d-x_v3.x_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Cocos2d-x v3.x 系列
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="2.1" data-path="cocos2d-x_v3.0_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.0_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Cocos2d-x v3.0 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="cocos2d-x_v3.0_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.0_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Cocos2d-x v3.0 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.3" data-path="cocos2d-x_v3.1_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.1_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                         Cocos2d-x v3.1 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.4" data-path="cocos2d-x_v3.1_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.1_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                         Cocos2d-x v3.1 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.5" data-path="cocos2d-x_v3.2_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.2_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                         Cocos2d-x v3.2 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.6" data-path="cocos2d-x_v3.2_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.2_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                         Cocos2d-x v3.2 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.7" data-path="cocos2d-x_v3.3_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.3_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                         Cocos2d-x v3.3 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.8" data-path="cocos2d-x_v3.3_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.3_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                         Cocos2d-x v3.3 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.9" data-path="cocos2d-x_v3.4_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.4_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                         Cocos2d-x v3.4 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.10" data-path="cocos2d-x_v3.4_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.4_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                         Cocos2d-x v3.4 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.11" data-path="cocos2d-x_v3.5_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.5_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.11.</b>
                        
                         Cocos2d-x v3.5 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.12" data-path="cocos2d-x_v3.5_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.5_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.12.</b>
                        
                         Cocos2d-x v3.5 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.13" data-path="cocos2d-x_v3.6_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.6_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.13.</b>
                        
                         Cocos2d-x v3.6 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.14" data-path="cocos2d-x_v3.6_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.6_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.14.</b>
                        
                         Cocos2d-x v3.6 英文发布说明
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="cocos2d-x_v4.x_release_notes.html">
            
                
                    <a href="./cocos2d-x_v4.x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Cocos2d-x v4.x 系列
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Cocos2d-x 版本发布说明</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_5">
                    
                        <h1 id="cocos2d-x-v30-">cocos2d-x v3.0 发布说明</h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>目录</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank">DocToc</a></em></p>
<ul>
<li><a href="#%E6%A6%82%E5%86%B5">概况</a></li>
<li><a href="#%E9%9C%80%E6%B1%82">需求</a><ul>
<li><a href="#%E7%8E%AF%E5%A2%83%E9%9C%80%E6%B1%82">环境需求</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E9%9C%80%E6%B1%82">编译需求</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C-testcpp">如何运行 TestCpp</a><ul>
<li><a href="#mac-osx-&amp;-ios">Mac OSX &amp; iOS</a></li>
<li><a href="#android">Android</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%A7%8B%E4%B8%80%E4%B8%AA%E6%96%B0%E6%B8%B8%E6%88%8F">如何开始一个新游戏</a></li>
</ul>
</li>
<li><a href="#v30-%E4%BA%AE%E7%82%B9">v3.0 亮点</a></li>
<li><a href="#%E7%BB%86%E8%8A%82">细节</a><ul>
<li><a href="#c11-%E7%89%B9%E6%80%A7">C++11 特性</a><ul>
<li><a href="#stdfunction">std::function</a></li>
<li><a href="#%E5%BC%BA%E7%B1%BB%E5%9E%8B%E6%9E%9A%E4%B8%BE">强类型枚举</a></li>
<li><a href="#%E8%A6%86%E7%9B%96">覆盖</a></li>
</ul>
</li>
<li><a href="#%E5%8E%BBoc%E5%8C%96">去OC化</a><ul>
<li><a href="#%E7%A7%BB%E9%99%A4c%E7%B1%BB%E7%9A%84%E2%80%9Ccc%E2%80%9D%E5%89%8D%E7%BC%80%E4%BB%A5%E5%8F%8Afree-functions">移除C++类的“cc”前缀以及free functions</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-clone-%E6%9B%BF%E4%BB%A3-copy">使用 clone 替代 copy</a></li>
<li><a href="#%E5%8D%95%E4%BE%8B%E7%B1%BB%E9%87%87%E7%94%A8%E4%BA%86-getinstance-%E5%92%8C-destroyinstance">单例类采用了 getInstance 和 destroyInstance</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E4%BA%86-ref-%E4%BB%A3%E6%9B%BF%E4%BA%86-object">使用了 Ref 代替了 Object</a></li>
<li><a href="#getters">getters</a></li>
<li><a href="#pod-%E7%B1%BB%E5%9E%8B">POD 类型</a></li>
</ul>
</li>
<li><a href="#%E6%96%B0%E7%9A%84%E6%B8%B2%E6%9F%93%E5%99%A8">新的渲染器</a><ul>
<li><a href="#%E6%B8%B2%E6%9F%93%E5%99%A8%E7%89%B9%E6%80%A7">渲染器特性</a><ul>
<li><a href="#%E8%87%AA%E5%8A%A8%E6%89%B9%E5%A4%84%E7%90%86">自动批处理</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E5%89%94%E9%99%A4">自动剔除</a></li>
<li><a href="#%E5%85%A8%E5%B1%80-z-%E5%80%BC">全局 Z 值</a></li>
</ul>
</li>
<li><a href="#sprite-%E5%92%8C-spritebatchnode">Sprite 和 SpriteBatchNode</a></li>
</ul>
</li>
<li><a href="#%E4%BC%98%E5%8C%96-labelttf--labelbmfont--labelatlas">优化 LabelTTF / LabelBMFont / LabelAtlas</a></li>
<li><a href="#%E6%96%B0%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6">新的事件分发机制</a></li>
<li><a href="#%E7%89%A9%E7%90%86%E5%BC%95%E6%93%8E%E9%9B%86%E6%88%90">物理引擎集成</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96-api-%E5%8F%98%E6%9B%B4">其他 API 变更</a><ul>
<li><a href="#cctypesh"><code>ccTypes.h</code></a></li>
<li><a href="#%E5%BC%83%E7%94%A8%E7%9A%84%E5%87%BD%E6%95%B0%E5%92%8C%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">弃用的函数和全局变量</a></li>
</ul>
</li>
<li><a href="#lua-%E7%BB%91%E5%AE%9A%E7%9A%84%E4%BF%AE%E6%94%B9">Lua 绑定的修改</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8-lua-%E7%BB%91%E5%AE%9A%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7">使用 Lua 绑定生成工具</a><ul>
<li><a href="#%E7%BB%91%E5%AE%9A%E5%B8%A6%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E7%B1%BB%E5%88%B0-lua">绑定带命名空间的类到 Lua</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-scripthandlermgr-%E6%9D%A5%E7%AE%A1%E7%90%86%E6%B3%A8%E5%86%8C%E5%92%8C%E6%B3%A8%E9%94%80-lua-%E5%87%BD%E6%95%B0">使用 ScriptHandlerMgr 来管理注册和注销 Lua 函数</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E5%AE%83-api-%E5%8F%98%E6%9B%B4">其它 API 变更</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8-cc%E3%80%81ccs%E3%80%81ccui-gl-%E5%92%8C-sp-%E4%BD%9C%E4%B8%BA%E6%A8%A1%E5%9D%97%E5%90%8D">使用 <code>cc</code>、<code>ccs</code>、<code>ccui</code> <code>gl</code> 和 <code>sp</code> 作为模块名</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E5%90%8D%E4%BF%AE%E6%94%B9">函数名修改</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%BA%9B%E6%A8%A1%E5%9D%97">添加一些模块</a></li>
<li><a href="#%E5%A2%9E%E5%8A%A0%E6%9B%B4%E5%A4%9A%E7%9A%84-lua-%E7%BB%91%E5%AE%9A">增加更多的 Lua 绑定</a></li>
<li><a href="#%E5%B0%86%E4%B8%80%E4%BA%9B-lua-%E7%BB%91%E5%AE%9A%E7%9A%84%E7%B1%BB%E6%88%96%E7%BB%93%E6%9E%84%E4%BD%93%E6%9B%BF%E6%8D%A2%E6%88%90%E8%A1%A8">将一些 Lua 绑定的类或结构体替换成表</a></li>
<li><a href="#%E6%94%AF%E6%8C%81-lua-%E8%84%9A%E6%9C%AC%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8-object-c-%E4%BB%A3%E7%A0%81%E5%92%8C-java-%E4%BB%A3%E7%A0%81">支持 Lua 脚本代码调用 Object-C 代码和 java 代码</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%BA%9B-lua-%E6%96%87%E4%BB%B6%E6%9D%A5%E5%82%A8%E5%AD%98%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A8%A1%E5%9D%97%E5%B8%B8%E9%87%8F">添加一些 Lua 文件来储存不同的模块常量</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="">概况</h1>
<ul>
<li>下载: <a href="http://www.cocos2d-x.org/filedown/cocos2d-x-3.0-cn" target="_blank">http://www.cocos2d-x.org/filedown/cocos2d-x-3.0-cn</a></li>
<li>完整更新日记: <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.0beta/CHANGELOG" target="_blank">https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.0beta/CHANGELOG</a></li>
<li>API参考手册: <a href="http://www.cocos2d-x.org/reference/native-cpp/V3.0beta/index.html" target="_blank">http://www.cocos2d-x.org/reference/native-cpp/V3.0beta/index.html</a></li>
</ul>
<h1 id="">需求</h1>
<h2 id="">环境需求</h2>
<ul>
<li>Android 2.3 及以上</li>
<li>iOS 5.0 及以上</li>
<li>OS X 10.7 及以上</li>
<li>Windows 7 及以上</li>
<li>Windows Phone 8 及以上（初级阶段）</li>
<li>Linux Ubuntu 12.04 及以上</li>
<li><del>Browsers via Emscripten</del> 暂不支持</li>
</ul>
<h2 id="">编译需求</h2>
<ul>
<li>Xcode 4.6 (for iOS or Mac)</li>
<li>gcc 4.7 for Linux or Android. Android 要求 ndk-r9 及以上.</li>
<li>Visual Studio 2012 (for Windows)</li>
</ul>
<h2 id="-testcpp">如何运行 TestCpp</h2>
<h3 id="mac-osx--ios">Mac OSX &amp; iOS</h3>
<ul>
<li>进入 <code>cocos2d-x/build</code> 文件夹, 打开 <code>cocos2d_test.xcodeproj</code></li>
<li>在 Xcode 的 scheme toolbar 选择 <code>iOS</code> 或者 <code>OS X</code> 平台</li>
<li>点击 <code>run</code> 按钮</li>
</ul>
<h3 id="android">Android</h3>
<p>你可以运行一下示例...</p>
<p><strong>使用命令行：</strong></p>
<pre><code>$ cd cocos2d-x
$ ./setup.py
$ cd build
$ ./android-build.py cpp-empty-test -p 10
$ adb install cocos2d-x/tests/cpp-empty-test/proj.android/bin/CppEmptyTest-debug.apk
</code></pre><p>然后点击安卓设备上的程序运行测试例，<code>-p</code> 指定了 Android API 等级，cocos2d-x 支持 level10 以上。</p>
<p><strong>使用 Eclipse</strong></p>
<pre><code>$ cd cocos2d-x
$ ./setup.py
$ cd build
$ ./android-build.py cpp-empty-test -p 10
</code></pre><p>然后</p>
<ul>
<li>把 cocos2d-x Android 项目导入 Eclipse 中，导入的路径是 <code>cocos/2d/platform/android</code></li>
<li>把 <code>cpp-empty-test</code> Android 项目导入 Eclipse 中，导入的路径是 <code>tests/cpp-empty-test/proj.android</code></li>
<li>编译 <code>cpp-empty-test</code> Android 项目，然后运行即可</li>
</ul>
<h3 id="windows">Windows</h3>
<ul>
<li>进入 <code>cocos2d-x/build</code> 目录, 然后打开 <code>cocos2d-win32.vs2012.sln</code> 文件</li>
<li>选择 <code>cpp-empty-test</code> 作为启动项</li>
<li>点击运行按钮</li>
</ul>
<h3 id="linux">Linux</h3>
<pre><code>$ cd cocos2d-x/build
$ ./install-deps-linux.sh
$ cd ../..
</code></pre><p>然后</p>
<pre><code>$ mkdir build
$ cd build
$ cmake ../cocos2d-x
$ make -j4
</code></pre><p>运行</p>
<pre><code>$ cd bin/cpp-empty-test
$ ./cpp-empty-test
</code></pre><h2 id="">如何开始一个新游戏</h2>
<p>请参考 <a href="https://github.com/cocos2d/cocos2d-x/blob/develop/README.md" target="_blank">说明</a> 和 <a href="https://github.com/chukong/cocos-docs/blob/master/manual/framework/native/getting-started/v3.0/how-to-start-a-new-game/en.md" target="_blank">文档</a> 。</p>
<h1 id="v30-">v3.0 亮点</h1>
<ul>
<li>使用 C++(C++11) 的特性取代了 Objective-C 的特性</li>
<li>优化了 Labels</li>
<li>优化了渲染器（比 v2.2 更快）</li>
<li>新的事件分发机制</li>
<li>物理引擎集成</li>
<li>新的 UI 对象</li>
<li><a href="https://github.com/cocos2d/cocos-docs/blob/master/manual/framework/native/scripting/javascript/js-remote-debugger/en.md" target="_blank">JavaScript 远程调试器</a></li>
<li>支持远程控制台</li>
<li>使用 <a href="https://github.com/cocos2d/cocos2d-console" target="_blank">cocos console</a>创建和运行项目</li>
<li>重构 Image - 及时释放内存，统一了支持文件格式的 API</li>
<li>自动生成 Lua 绑定，添加了 LuaJavaBridge 和 LuaObjcBridge</li>
<li>模板容器<ul>
<li>使用 <code>cocos2d::Map&lt;&gt;</code> 替代了 <code>CCDictionary</code> , <a href="https://github.com/cocos2d/cocos-docs/blob/master/manual/framework/native/data-structure/v3/map/en.md" target="_blank">用法</a></li>
<li>使用 <code>cocos2d::Vector&lt;&gt;</code> 替代了 <code>CCArray</code>, <a href="https://github.com/cocos2d/cocos-docs/blob/master/manual/framework/native/data-structure/v3/vector/en.md" target="_blank">用法</a></li>
<li>使用 <code>cocos2d::Value</code> 替代了 <code>CCBool</code>, <code>CCFLoat</code>, <code>CCDouble</code>, <a href="https://github.com/cocos2d/cocos-docs/blob/master/manual/framework/native/data-structure/v3/value/en.md" target="_blank">用法</a></li>
</ul>
</li>
</ul>
<h1 id="">细节</h1>
<h2 id="c11-">C++11 特性</h2>
<p><em>从 v3.0-pre-alpha0 开始，这些特性被添加</em></p>
<p>C++11 的一部分特性已经被使用到 cocos2d-x 中了：</p>
<ul>
<li><code>std::function</code>, 包含了回调中使用的 lambda 对象</li>
<li>对于大多数的 cocos2d-x 枚举和常量采用了强类型枚举</li>
<li>在线程中使用了 <code>std::thread</code></li>
<li>对于 Override 和 final 方法，增加了 <code>override</code> 和 <code>final</code> 上下文关键字</li>
</ul>
<h3 id="stdfunction">std::function</h3>
<ul>
<li><code>CallFunc</code> 可以由 <code>std::function&lt;void()&gt;</code> 来创建</li>
<li><code>CallFuncN</code> 可以由 <code>std::function&lt;void(Node*)&gt;</code> 来创建</li>
<li><code>CallFuncND</code> 和 <code>CallFuncO</code> 已经被移除了因为它们可以类似地由 <code>CallFuncN</code> 和 <code>CallFunc</code> 来创建. 可以查看示例中的 ActionsTest.cpp 文件</li>
<li><code>MenuItem</code> 支持 <code>std::function&lt;void(Node*)&gt;</code> 作为回调</li>
</ul>
<p><code>CallFunc</code> 示例:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// v2.1 版本</span>
CCCallFunc *action1 = CCCallFunc::create( <span class="hljs-keyword">this</span>, callfunc_selector( MyClass::callback_0 ) );

<span class="hljs-comment">// v3.0 版本 (短版本)</span>
<span class="hljs-keyword">auto</span> action1 = CallFunc::create( CC_CALLBACK_0(MyClass::callback_0,<span class="hljs-keyword">this</span>));
<span class="hljs-keyword">auto</span> action2 = CallFunc::create( CC_CALLBACK_0(MyClass::callback_1,<span class="hljs-keyword">this</span>, additional_parameters));

<span class="hljs-comment">// v3.0 版本 (长版本)</span>
<span class="hljs-keyword">auto</span> action1 = CallFunc::create( std::bind( &amp;MyClass::callback_0, <span class="hljs-keyword">this</span>));
<span class="hljs-keyword">auto</span> action2 = CallFunc::create( std::bind( &amp;MyClass::callback_1, <span class="hljs-keyword">this</span>, additional_parameters));

<span class="hljs-comment">// v3.0 中你也可以使用lambda表达式或者其他函数对象</span>
<span class="hljs-keyword">auto</span> action1 = CallFunc::create(
                 [&amp;](){
                     <span class="hljs-keyword">auto</span> s = Director::sharedDirector()-&gt;getWinSize();
                     <span class="hljs-keyword">auto</span> label = LabelTTF::create(<span class="hljs-string">"called:lambda callback"</span>, <span class="hljs-string">"Marker Felt"</span>, <span class="hljs-number">16</span>);
                     label-&gt;setPosition(ccp( s.width/<span class="hljs-number">4</span>*<span class="hljs-number">1</span>,s.height/<span class="hljs-number">2</span>-<span class="hljs-number">40</span>));
                     <span class="hljs-keyword">this</span>-&gt;addChild(label);
                 }  );
</code></pre>
<p><code>MenuItem</code> 示例:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// v2.1 版本</span>
CCMenuItemLabel *item = CCMenuItemLabel::create(label, <span class="hljs-keyword">this</span>, menu_selector(MyClass::callback));

<span class="hljs-comment">// v3.0 版本 (短版本)</span>
<span class="hljs-keyword">auto</span> item = MenuItemLabel::create(label, CC_CALLBACK_1(MyClass::callback, <span class="hljs-keyword">this</span>));

<span class="hljs-comment">// v3.0 版本 (长版本)</span>
<span class="hljs-keyword">auto</span> item = MenuItemLabel::create(label, std::bind(&amp;MyClass::callback, <span class="hljs-keyword">this</span>, std::placeholders::_1));

<span class="hljs-comment">// v3.0 中你也可以使用lambda表达式或者其他函数对象</span>
<span class="hljs-keyword">auto</span> item = MenuItemLabel::create(label,
                 [&amp;](Object *sender) {
                     <span class="hljs-comment">// do something. Item "sender" clicked</span>
                  });
</code></pre>
<h3 id="">强类型枚举</h3>
<p><em>从 v3.0-pre-alpha0 开始，这些特性被添加</em></p>
<p>以 <code>k</code> 开头的常量和枚举量，通常被定义为 <code>int</code> 或者简单的 <code>enum</code> 类型，现在已经被强类型枚举（<code>enum class</code>）所替代，这样有利于避免冲突和类型错误。</p>
<p>新的格式是:</p>
<pre><code>| v2.1       | v3.0        |
| kTypeValue | Type::VALUE |
</code></pre><p>示例:</p>
<pre><code>| v2.1                             | v3.0                             |
| kCCTexture2DPixelFormat_RGBA8888 | Texture2D::PixelFormat::RGBA8888 |
| kCCDirectorProjectionCustom      | Director::Projection::CUSTOM     |
| ccGREEN                          | Color3B::GREEN                   |
| CCPointZero                      | Point::ZERO                      |
| CCSizeZero                       | Size::ZERO                       |
</code></pre><p>旧的值仍然是可以使用的，但是已经被标记为 deprecated.</p>
<h3 id="">覆盖</h3>
<p>为了捕获覆盖方法中可能出现的错误，子类的覆盖方法添加了 <code>override</code> 的关键字。</p>
<p>示例:</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">class</span> Sprite : <span class="hljs-keyword">public</span> Node {
    <span class="hljs-keyword">bool</span> isFlipY(<span class="hljs-keyword">void</span>) <span class="hljs-keyword">const</span>;
    <span class="hljs-keyword">void</span> setFlipY(<span class="hljs-keyword">bool</span> bFlipY);

    <span class="hljs-comment">// Overrides</span>
    <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> setTexture(Texture2D *texture) override;
    <span class="hljs-keyword">virtual</span> Texture2D* getTexture() <span class="hljs-keyword">const</span> override;
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> setBlendFunc(<span class="hljs-keyword">const</span> BlendFunc &amp;blendFunc) override;
    <span class="hljs-keyword">inline</span> <span class="hljs-keyword">const</span> BlendFunc&amp; getBlendFunc() <span class="hljs-keyword">const</span> override;
}
</code></pre>
<h2 id="oc">去OC化</h2>
<p><em>从 v3.0-pre-alpha0 开始，这些特性被添加</em></p>
<h3 id="cccfree-functions">移除C++类的“cc”前缀以及free functions</h3>
<p><em>类的变更</em></p>
<p>因为 cocos2d-x 已经使用了 <code>cocos2d</code> 的命名空间，因此也就不需要在所有的类中添加 <code>CC</code> 的前缀。
示例:</p>
<pre><code>| v2.1       | v3.0     |
| CCSprite   | Sprite   |
| CCNode     | Node     |
| CCDirector | Director |
| etc...                |
</code></pre><p>v2.1 类名仍然有效，但是已经被标记为 deprecated。</p>
<p><em>free functions 的变更</em></p>
<p>对于 <em>drawing primitives</em>:</p>
<ul>
<li>已经被添加到 <code>DrawPrimitives</code> 命名空间</li>
<li>移除 <code>cc</code> 前缀</li>
</ul>
<p>对于 <em>gl proxy functions</em>:</p>
<ul>
<li>已经被添加到 <code>GL</code> 命名空间</li>
<li>移除 <code>ccGL</code> 前缀</li>
</ul>
<p>示例:</p>
<pre><code>| v2.1                | v3.0                         |
| ccDrawPoint()       | DrawPrimitives::drawPoint()  |
| ccDrawCircle()      | DrawPrimitives::drawCircle() |
| ccGLBlendFunc()     | GL::blendFunc()              |
| ccGLBindTexture2D() | GL::bindTexture2D()          |
| etc...                                                 |
</code></pre><p>v2.1 free functions 仍然有效，但已经被标记为 deprecated。</p>
<h3 id="-clone--copy">使用 clone 替代 copy</h3>
<p><code>clone()</code> 返回了一份 autoreleased 版本的拷贝。</p>
<p><code>copy()</code> 不再被支持，如果你使用它，仍然是可以编译的，但是代码会崩掉。</p>
<p>示例:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// v2.1</span>
CCMoveBy *action = (CCMoveBy*) move-&gt;copy();
action-&gt;autorelease();

<span class="hljs-comment">// v3.0</span>
<span class="hljs-comment">// 不需要使用autorelease，也不需要做转换</span>
<span class="hljs-keyword">auto</span> action = move-&gt;clone();
</code></pre>
<h3 id="-getinstance--destroyinstance">单例类采用了 getInstance 和 destroyInstance</h3>
<p>所有的单例类使用 <code>getInstance()</code> 和 <code>destroyInstance()</code> (如果可用) 来获取和摧毁实例。</p>
<p>Examples:</p>
<pre><code>| v2.1                          | v3.0                        |
| CCDirector-&gt;sharedDirector()  | Director-&gt;getInstance()     |
| CCDirector-&gt;endDirector()     | Director-&gt;destroyInstance() |
| etc...                                                      |
</code></pre><p>v2.1 方法仍然有效，但已经被标记为 deprecated。</p>
<h3 id="-ref--object">使用了 Ref 代替了 Object</h3>
<p>因为 <code>Object</code> 容易让人混淆，所以重命名为 <code>Ref</code> ，同时移除了和引用计数无关的函数，之前所有继承于 <code>Object</code> 的类现在都改为继承于 <code>Ref</code>。</p>
<h3 id="getters">getters</h3>
<p>Getters 现在使用了 <code>get</code> 前缀。</p>
<p>示例:</p>
<pre><code>| v2.1                            | v3.0*                                 |
| node-&gt;boundingBox()             | node-&gt;getBoundingBox()                |
| sprite-&gt;nodeToParentTransform() | sprite-&gt;getNodeToParentTransform() |
| etc...                                                               |
</code></pre><p>当然 getters 在声明中也被标识为 <code>const</code> 。 示例:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// v2.1</span>
<span class="hljs-keyword">virtual</span> <span class="hljs-keyword">float</span> getScale();

<span class="hljs-comment">// v3.0</span>
<span class="hljs-keyword">virtual</span> <span class="hljs-keyword">float</span> getScale() <span class="hljs-keyword">const</span>;
</code></pre>
<p>v2.1 方法仍然有效，但已经被标记为 deprecated。</p>
<h3 id="pod-">POD 类型</h3>
<p>接收 POD 类型作为参数的方法（比如：<code>TexParams</code>, <code>Point</code>, <code>Size</code>,等等）已经修改为传递成 <code>const</code> 型引用。</p>
<p>示例:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// v2.1</span>
<span class="hljs-keyword">void</span> setTexParameters(ccTexParams* texParams);

<span class="hljs-comment">// v3.0</span>
<span class="hljs-keyword">void</span> setTexParameters(<span class="hljs-keyword">const</span> ccTexParams&amp; texParams);
</code></pre>
<h2 id="">新的渲染器</h2>
<p><em>v3.0-beta 中，这些特性被添加， v3.0-beta2 中进行了优化</em></p>
<p>Cocos2d-x v2.2 中渲染方式是没问题的，但是它难以进行优化，也难以添加新的功能和移植到新的平台。
所以，Cocos2d-x v3.0 有了一个更威武，更优雅，更易扩展，更灵活的新渲染器，但是它依旧很容易使用也很好理解。Cocos2d-x 的老用户们将会发现新的API是如此的熟悉，根本不需要去考虑底层做了什么改变和更新，用起来仍然是这么的舒服。</p>
<p>新渲染器特性:</p>
<ul>
<li>它已经从 Scene Graph 中分离出来，<code>draw()</code> 方法替代了 “drawing” 发送了一个 <code>渲染命令</code> 给 <code>渲染器</code>，而 <code>渲染器</code> 负责绘制排队的 <code>渲染命令</code> 。</li>
<li><code>QuadCommands</code> (<code>Sprite</code> 和 <code>ParticleSystem</code> 对象使用) 将会自动进行批处理。</li>
<li><code>CustomCommand</code> 对象允许用户自定义 OpenGL 代码，使用的 API 类似 v2.2。</li>
<li><code>GroupCommand</code> 对象允许渲染器中拥有不同 OpenGL 值的“堆栈”。</li>
<li><code>Sprite</code> 的自动剔除功能（虽然从技术上讲，自动剔除功能是表现在 <code>Sprite</code> 代码上而不是 <code>Renderer</code> 代码上）</li>
<li>全局 Z 轴顺序 (局部 Z 轴顺序仍然有效)</li>
</ul>
<p>更多的细节信息，可以阅读如下文档: <a href="https://docs.google.com/document/d/17zjC55vbP_PYTftTZEuvqXuMb9PbYNxRFu0EGTULPK8/edit" target="_blank">Renderer Specification document</a></p>
<h3 id="">渲染器特性</h3>
<h4 id="">自动批处理</h4>
<p>自动批处理功能意味着 <code>渲染器</code>将会把 <code>多次绘制调用</code> 打包为一次 <code>大的绘制调用</code>（AKA batch）。组合 <code>绘制调用</code>当然需要满足一定的条件：</p>
<ul>
<li>它仅工作在 <code>QuadCommand</code> 命令下（由 Sprite 和 ParticleSystem 对象使用）</li>
<li><code>QuadCommadnds</code> 必须共享相同的材质 ID ：相同的纹理ID，相同的 GLProgram 和相同的混合功能</li>
<li><code>QuadCommands</code> 必须是连续的 </li>
</ul>
<p>如果这些条件都满足的话，<code>渲染器</code> 将会使用所有这些 <code>QuadCommand</code> 对象创建一个批处理（一次绘制调用）。</p>
<p>如果你不熟悉 OpenGL 的使用，批处理对于您游戏的能否拥有一个流畅的运行速度是很重要的，越少的批处理（绘制调用）越有利于您游戏的表现力。</p>
<h4 id="">自动剔除</h4>
<p>目前，自动剔除功能只在 <code>Sprite</code> 对象中实现。</p>
<p>当 <code>Sprite::draw()</code> 被调用的时候，它将会检查 <code>Sprite</code> 是否超出屏幕，如果是的话，它将不会发送 <code>QuadCommand</code> 命令给 <code>渲染器</code>,因此可以获得一些性能上的提升。</p>
<h4 id="-z-">全局 Z 值</h4>
<p><code>Node</code> 增加了新的函数 <code>setGlobalZOrder()</code> / <code>getGlobalZOrder()</code>,之前的旧函数 <code>setZOrder()</code> / <code>getZOrder()</code> 也被重命名为 <code>setLocalZOrder()</code> / <code>getLocalZOrder()</code>。</p>
<p><code>globalZOrder</code> 是一个 <code>float</code> （不是 <code>int</code>）的参数。这个值在 <code>渲染器</code> 中用来给 <code>RenderCommand</code> 排序。较低的值拥有较高的优先级。这意味着一个 <code>globalZorder</code> 为 <code>-10</code>的节点会比一个 <code>globalZOrder</code> 为 <code>10</code> 的节点优先绘制。</p>
<p><code>globalZOrder</code> 为 <code>0</code> （默认值）的节点将会根据 Scene Graph 顺序绘制。</p>
<p>如果 <code>globalZOrder</code> 不变的话，Cocos2d-x v3.0 和 Cocos2d-x v2.2 行为一致。</p>
<p><strong><code>globalZOrder()</code> 和 <code>localZOrder()</code></strong>:</p>
<ul>
<li><code>globalZOrder</code> 是用于 <code>渲染器</code> 中用来给“绘制命令”排序的</li>
<li><code>localZOrder</code> 是用于父节点的子节点数组中给 <code>节点</code> 对象排序的</li>
</ul>
<p><strong>例外</strong>:</p>
<p>待办事项</p>
<h3 id="sprite--spritebatchnode">Sprite 和 SpriteBatchNode</h3>
<p>v2.2
2.2版本中推荐的优化游戏方式是将 <code>SpriteBatchNode</code> 对象设置为 <code>Sprite</code> 对象的父节点。
虽然使用 <code>SpriteBatchNode</code> 对象仍然是一个非常好的优化游戏的方式，但是它仍然有一定的限制：</p>
<ul>
<li><code>Sprite</code> 对象的孩子只能是 <code>Sprite</code> （否则，Cocos2d-x 会触发断言）<ul>
<li>当 <code>Sprite</code> 的父节点是 <code>SpriteBactchNode</code> 时，不能添加 <code>ParticleSystem</code> 作为 <code>Sprite</code>的子节点。</li>
<li>这将导致当 <code>Sprite</code> 的父节点是 <code>SpriteBatchNode</code> 时，不能使用 <code>ParallaxNode</code></li>
</ul>
</li>
<li>所有的 <code>Sprite</code> 对象必须共享相同的纹理ID (否则，Cocos2d-x 会触发断言)</li>
<li><code>Sprite</code> 对象使用 <code>SpriteBatchNode</code> 的混合函数和着色器。</li>
</ul>
<p>虽然 v3.0 仍然支持 <code>SpriteBatchNode</code> （与之前的版本拥有相同的特效和限制），但是我们不鼓励使用它。相反，我们推荐直接使用 <code>Sprite</code>，不需要再它作为子节点添加到 <code>SpriteBatchNode</code> 中。</p>
<p>但是，为了能让 v3.0 有更好的表现，你必须要确保你的 <code>Sprite</code> 对象满足以下条件：</p>
<ul>
<li>贡献相同的纹理ID（把它们放在一个spritesheet中，就像使用 <code>SpriteBatchNode</code> 一样）</li>
<li>确保它们使用相同的着色器和混合函数（就像使用 <code>SpriteBatchNode</code> 一样）</li>
</ul>
<p>如果这么做， <code>Sprites</code> 将会像使用 <code>SpriteBatchNode</code> 一样的快...（在旧设备上大概慢了10%，在新设备上基本上察觉不出）</p>
<p>v2.2 和 v3.0 最大的区别在于：</p>
<ul>
<li><code>Sprite</code> 对象可以有不同的纹理ID。</li>
<li><code>Sprite</code> 对象可以有不同种类的 <code>Node</code> 作为子节点，包括 <code>ParticleSystem</code>。</li>
<li><code>Sprite</code> 对象可以有不同的混合函数和不同的着色器。</li>
</ul>
<p>但是如果你这么做，<code>渲染器</code> 可能无法对它所有的子节点进行批处理（性能较低）。但是游戏仍然可以正常运行，不会触发任何断言。</p>
<p><strong>总结</strong>:</p>
<ul>
<li>保持将所有的精灵放在一张大的 spritesheet 中。</li>
<li>使用相同的混合函数（使用默认）</li>
<li>使用相同的着色器（使用默认）</li>
<li>不要将精灵添加到 <code>SpriteBatchNode</code></li>
</ul>
<p>只有当你需要一些额外的性能上提升（虽然很小），<code>SpriteBatchNode</code> 才会是你最后的选择（你需要对它的限制条件很熟悉）。</p>
<h2 id="-labelttf--labelbmfont--labelatlas">优化 LabelTTF / LabelBMFont / LabelAtlas</h2>
<p><em>这些特性从 v3.0-alpha0 开始被添加</em></p>
<p><code>LabelTTF</code>, <code>LabelBMFont</code> 和 <code>LabelAtlas</code> 将会被新的 <code>Label</code> 代替. 新的 <code>Label</code> 带来的好处有:</p>
<ul>
<li>统一了创建 <code>LabelTTF</code>, <code>LabelBMFont</code> 和 <code>LabelAtlas</code> 的 API</li>
<li>使用 <code>freetype</code> 生成 labels 的纹理，这样就能保证在不同的平台下 labels 有相同的效果。</li>
<li>缓存纹理以提高性能</li>
</ul>
<h2 id="">新的事件分发机制</h2>
<p><em>这些特性从 v3.0-alpha0 开始被添加</em></p>
<p>触摸事件，键盘事件，加速器事件和自定义事件等所有事件都由 <code>EventDispatcher</code> 分发。
<code>TouchDispatcher</code>, <code>KeypadDispatcher</code>, <code>KeyboardDispatcher</code>, <code>AccelerometerDispatcher</code> 已经被移除。</p>
<p><code>EventDispatcher</code> 的特性主要有:</p>
<ul>
<li>事件的分发基于渲染顺序</li>
<li>所有的事件都由 <code>EventDispatcher</code> 分发</li>
<li>可以使用 <code>EventDispatcher</code> 来分发自定义事件</li>
<li>可以注册一个 lambda 表达式作为回调函数</li>
</ul>
<p>更多 <code>EventDispatcher</code> 细节可以参考 <a href="https://github.com/chukong/cocos-docs/blob/master/manual/framework/native/input/event-dispatcher/en.md" target="_blank">这个文档</a>。</p>
<h2 id="">物理引擎集成</h2>
<p><em>这些特性从 v3.0-pre-alpha0 开始被添加</em></p>
<p>在 v3.0 中，我们把基于 <a href="https://chipmunk-physics.net/" target="_blank">Chipmunk2D</a> 的物理引擎集成到 Cocos2d-x 中，通过这些特性，你可以很容易创建基于物理效果的游戏，而不必去理解物理引擎。</p>
<p>更的关于物理引擎集成的细节可以参考 <a href="https://github.com/cocos2d/cocos-docs/blob/master/manual/framework/native/physics/physics-integration/en.md" target="_blank">这个文档</a>。</p>
<h1 id="-api-">其他 API 变更</h1>
<h2 id="cctypesh"><code>ccTypes.h</code></h2>
<p>在 ccType.h 中删除结构命名中的 <em>cc</em> 前缀，将全局函数移至静态成员函数，将全局常量移至静态成员常量。</p>
<pre><code>| v2.1 struct names       | v3.0 struct names |
| ccColor3B               | Color3B |
| ccColor4B               | Color4B |
| ccColor4F               | Color4F |
| ccVertex2F               | Vertex2F |
| ccVertex3F               | Vertex3F |
| ccTex2F                   | Tex2F |
| ccPointSprite           | PointSprite |
| ccQuad2                   | Quad2 |
| ccQuad3                   | Quad3 |
| ccV2F_C4B_T2F           | V2F_C4B_T2F |
| ccV2F_C4F_T2F           | V2F_C4F_T2F |
| ccV3F_C4B_T2F           | V3F_C4B_T2F |
| ccV2F_C4B_T2F_Triangle  | V2F_C4B_T2F_Triangle |
| ccV2F_C4B_T2F_Quad      | V2F_C4B_T2F_Quad |
| ccV3F_C4B_T2F_Quad      | V3F_C4B_T2F_Quad |
| ccV2F_C4F_T2F_Quad      | V2F_C4F_T2F_Quad |
| ccBlendFunc               | BlendFunc |
| ccT2F_Quad               | T2F_Quad |
| ccAnimationFrameData    | AnimationFrameData |
</code></pre><p>全局函数变更示例</p>
<pre><code class="lang-c++"><span class="hljs-comment">// in v2.1</span>
ccColor3B color3B = ccc3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
ccc3BEqual(color3B, ccc3(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
ccColor4B color4B = ccc4(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
ccColor4F color4F = ccc4f(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
color4F = ccc4FFromccc3B(color3B);
color4F = ccc4FFromccc4B(color4B);
ccc4FEqual(color4F, ccc4F(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
color4B = ccc4BFromccc4F(color4F);

color3B = ccWHITE;

<span class="hljs-comment">// in v3.0</span>
Color3B color3B = Color3B(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
color3B.equals(Color3B(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
Color4B color4B = Color4B(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
Color4F color4F = Color4F(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
color4F = Color4F(color3B);
color4F = Color4F(color4B);
color4F.equals(Color4F(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
color4B = Color4B(color4F);

color3B = Color3B::WHITE;
</code></pre>
<h2 id="">弃用的函数和全局变量</h2>
<pre><code>| v2.1 names     | v3.0 names |
| ccp             | Point |
| ccpNeg         | Point::- |
| ccpAdd         | Point::+ |
| ccpSub         | Point::- |
| ccpMult         | Point::* |
| ccpMidpoint     | Point::getMidpoint |
| ccpDot         | Point::dot |
| ccpCrosss     | Point::cross |
| ccpPerp         | Point::getPerp |
| ccpRPerp         | Point::getRPerp |
| ccpProject     | Point::project |
| ccpRotate     | Point::rotate |
| ccpUnrotate     | Point::unrotate |
| ccpLengthSQ     | Point::getLengthSq() |
| ccpDistanceSQ | Point::getDistanceSq |
| ccpLength     | Point::getLength |
| ccpDistance     | Point::getDistance |
| ccpNormalize     | Point::normalize |
| ccpForAngle     | Point::forAngle |
| ccpToAngle     | Point::getAngle |
| ccpClamp         | Point::getClampPoint |
| ccpFromSize     | Point::Point |
| ccpCompOp        | Point::compOp |
| ccpLerp         | Point::lerp |
| ccpFuzzyEqual | Point::fuzzyEqual |
| ccpCompMult     | Point::Point |
| ccpAngleSigned | Point::getAngle |
| ccpAngle         | Point::getAngle |
| ccpRotateByAngle | Point::rotateByAngle |
| ccpLineInersect | Point::isLineIntersect |
| ccpSegmentIntersect | Point::isSegmentIntersect |
| ccpIntersectPoint | Point::getIntersectPoint |
| CCPointMake    | Point::Point |
| CCSizeMake    | Size::Size |
| CCRectMake     | Rect::Rect |
| PointZero     | Point::ZERO |
| SizeZero         | Size::ZERO |
| RectZero         | Rect::ZERO |
| TiledGrid3DAction::tile | TiledGrid3DAction::getTile |
| TiledGrid3DAction::originalTile | TiledGrid3DAction::getOriginalTile |
| TiledGrid3D::tile | TiledGrid3D::getTile |
| TiledGrid3D::originalTile | TiledGrid3D::getOriginalTile |
| Grid3DAction::vertex | Grid3DAction::getVertex |
| Grid3DAction::originalVertex | Grid3DAction::getOriginalVertex |
| Grid3D::vertex | Grid3D::getVertex |
| Grid3D::originalVertex | Grid3D::getOriginalVertex |
| Configuration::sharedConfiguration | Configuration::getInstance |
| Configuration::purgeConfiguration | Configuration::destroyInstance() |
| Director::sharedDirector() | Director::getInstance() |
| FileUtils::sharedFileUtils | FileUtils::getInstance |
| FileUtils::purgeFileUtils | FileUtils::destroyInstance |
| GLView::sharedOpenGLView | GLView::getInstance |
| ShaderCache::sharedShaderCache | ShaderCache::getInstance |
| ShaderCache::purgeSharedShaderCache | ShaderCache::destroyInstance |
| AnimationCache::sharedAnimationCache | AnimationCache::getInstance |
| AnimationCache::purgeSharedAnimationCache | AnimationCache::destroyInstance |
| SpriteFrameCache::sharedSpriteFrameCache | SpriteFrameCache::getInstance |
| SpriteFrameCache:: purgeSharedSpriteFrameCache | SpriteFrameCache::destroyInstance |
| NotificationCenter::sharedNotificationCenter | NotificationCenter::getInstance |
| NotificationCenter:: purgeNotificationCenter | NotificationCenter::destroyInstance |
| Profiler::sharedProfiler | Profiler::getInstance |
| UserDefault::sharedUserDefault | UserDefault::getInstance |
| UserDefault::purgeSharedUserDefault | UserDefault::destroyInstance |
| Application::sharedApplication | Application::getInstance |
| ccc3()         | Color3B() |
| ccc3BEqual()     | Color3B::equals() |
| ccc4()         | Color4B() |
| ccc4FFromccc3B() | Color4F() |
| ccc4f()         | Color4F() |
| ccc4FFromccc4B() | Color4F() |
| ccc4BFromccc4F() | Color4B() |
| ccc4FEqual()     | Color4F::equals() |
| ccWHITE         | Color3B::WHITE |
| ccYELLOW         | Color3B::YELLOW |
| ccBLUE         | Color3B::BLUE |
| ccGREEN         | Color3B::GREEN |
| ccRED         | Color3B::RED |
| ccMAGENTA     | Color3B::MAGENTA |
| ccBLACK         | Color3B::BLACK |
| ccORANGE         | Color3B::ORANGE |
| ccGRAY         | Color3B::GRAY |
| kBlendFuncDisable | BlendFunc::BLEND_FUNC_DISABLE |
</code></pre><h1 id="lua-">Lua 绑定的修改</h1>
<h2 id="-lua-">使用 Lua 绑定生成工具</h2>
<p>只需要为模块写个 ini 文件，而不必写一堆的 .pkg 文件。</p>
<h3 id="-lua">绑定带命名空间的类到 Lua</h3>
<p>之前不能绑定具有相同类名、不同命名空间的类到 Lua。为了解决这个问题，现在类的元表名已被修改了。比如，<code>CCNode</code> 将会被改为 <code>cc.Node</code> 。这样的改变将会影响如下一些API的使用。</p>
<pre><code>|           v2.x                   |                  v3.0             |
| tolua_usertype(tolua_S,&quot;CCNode&quot;) | tolua_usertype(tolua_S,&quot;cc.Node&quot;) |
| tolua_isusertable(tolua_S,1,&quot;CCNode&quot;,0,&amp;tolua_err         | tolua_isusertable(tolua_S,1,&quot;cc.Node&quot;,0,&amp;tolua_err  |
| tolua_isusertype(tolua_S,1,&quot;CCNode&quot;,0,&amp;tolua_err)         | tolua_isusertype(tolua_S,1,&quot;cc.Node&quot;,0,&amp;tolua_err)  |
| toluafix_pushusertype_ccobject(tolua_S, nID, pLuaID, (void*)tolua_ret,&quot;CCNode&quot;)         | toluafix_pushusertype_ccobject(tolua_S, nID, pLuaID, (void*)tolua_ret,&quot;cc.Node&quot;)  |
| tolua_pushusertype(tolua_S,(void*)tolua_ret,&quot;CCFileUtils&quot;)         | tolua_pushusertype(tolua_S,(void*)tolua_ret,&quot;cc.FileUtils&quot;)  |
| tolua.cast(pChildren[i + 1], &quot;CCNode&quot;)             | tolua.cast(pChildren[i + 1], &quot;cc.Node&quot;) |
</code></pre><h3 id="-scripthandlermgr--lua-">使用 ScriptHandlerMgr 来管理注册和注销 Lua 函数</h3>
<p>当我们想要为类的 Lua 函数添加注册和注销功能，我们需要改变声明和定义文件，然后绑定到 Lua。
在 v3.0 中，我们使用了 <code>ScriptHandlerMgr</code>。举个例子，我们可以看下 <code>MenuItem</code> 这个类：
在 v2.x 中，我们需要在 MenuItem 的头文件中添加一个声明：</p>
<pre><code class="lang-c++"> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> registerScriptTapHandler(<span class="hljs-keyword">int</span> nHandler);
 <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">void</span> unregisterScriptTapHandler(<span class="hljs-keyword">void</span>);
</code></pre>
<p>然后在 .cpp 文件中实现它们，在 Lua 脚本中使用它们：</p>
<pre><code class="lang-lua">menuItem:registerScriptTapHandler(luafunction)
</code></pre>
<p>在 v3.0 中，我们只需要在 <code>ScriptHandlerMgr</code> 中添加一个 <code>HandlerType</code> 的枚举类型，然后在 luascript 中实现即可：</p>
<pre><code class="lang-lua">ScriptHandlerMgr:getInstance():registerScriptHandler(menuItem, luafunction,cc.HANDLERTYPE_MENU_CLICKED)
</code></pre>
<h2 id="-api-">其它 API 变更</h2>
<h3 id="-ccccsccui-gl--sp-">使用 <code>cc</code>、<code>ccs</code>、<code>ccui</code> <code>gl</code> 和 <code>sp</code> 作为模块名</h3>
<p>现在类已经被绑定到不同的模块而不是使用全局模块。这可以避免和其他代码产生冲突。</p>
<ul>
<li><code>cocos2d</code>、<code>cocos2d::extension</code>、<code>CocosDenshion</code> 和 <code>cocosbuilder</code>  的类被绑到 <code>cc</code> 模块</li>
<li><code>cocos2d:ui</code> 的类被绑到 <code>ccui</code> 模块</li>
<li><code>spine</code> 的类被绑到 <code>sp</code> 模块</li>
<li><code>cocostudio</code> 的类被绑到 <code>ccs</code> 模块</li>
<li>全局变量被绑到相应的模块</li>
<li>所有关于 <code>openGl</code> 的函数和常量被绑到 <code>gl</code> 模块</li>
</ul>
<p>示例:</p>
<pre><code>| v2.1                    | v3.0                    |
| CCDirector              | cc.Director             |
| CCArmature              | ccs.Armature            |
| kCCTextAlignmentLeft    | cc.kCCTextAlignmentLeft |
</code></pre><h3 id="">函数名修改</h3>
<p>一些全局函数被重命名：</p>
<p>示例:</p>
<pre><code>| v2.1                    | v3.0                    |
| CCPoint/ccp             | cc.p                    |
| CCRect                  | cc.rect                 |
| CCColor3B               | cc.c3b                  |
| CCColor4B               | cc.c4b                  |
| CCColor4F               | cc.c4f                  |
</code></pre><h3 id="">添加一些模块</h3>
<p>在 v3.0 中，更多模块被绑定到 Lua，具体如下：</p>
<ul>
<li>physics</li>
<li>spine</li>
<li>XMLHttpRequest</li>
<li>OpenGL</li>
</ul>
<p><code>XMLHttpRequest</code> 和 <code>physics</code> 在 <code>cc</code> 模块中，<code>spine</code> 在 <code>sp</code> 模块中， <code>OpenGL</code> 在 <code>gl</code> 模块中，相关的测试例在：</p>
<ul>
<li>physics   ---&gt; TestLua/PhysicsTest</li>
<li>spine     ---&gt; TestLua/SpineTest</li>
<li>XMLHttpRequest ---&gt; TestLua/XMLHttpRequestTest</li>
<li>openGL    ---&gt; TestLua/OpenGLTest</li>
</ul>
<h3 id="-lua-">增加更多的 Lua 绑定</h3>
<p>比如：新的 Label、新的事件分发机制和 AssetsManager 等等。相关的测试例在：</p>
<ul>
<li>New Label ---&gt; TestLua/LabelTestNew</li>
<li>New EventDispatcher ---&gt;TestLua/NewEventDispatcherTest</li>
<li>AssetsManager  ---&gt; TestLua/AssetsManagerTest</li>
</ul>
<h3 id="-lua-">将一些 Lua 绑定的类或结构体替换成表</h3>
<p>在 v3.0中，所有 Lua 绑定的结构体类型被替换成表</p>
<p>示例:</p>
<pre><code>| v2.1                    | v3.0                    |
| CCPoint                 | lua table               |
| CCRect                  | lua table               |
| CCColor3B               | lua table               |
| CCColor4B               | lua table               |
| CCColor4F               | lua table               |
| CCAffineTransform       | lua table               |
| CCArray                 | lua table               |    
| CCDictionary            | lua table               |
| CCPointArray            | lua table               |
</code></pre><h3 id="-lua--object-c--java-">支持 Lua 脚本代码调用 Object-C 代码和 java 代码</h3>
<p><code>LuaObjcBridge</code> 和 <code>LuaJavaBridge</code> 被绑定到 Lua 以支持 Lua 脚本代码调用 Object-C 代码和 java 代码。</p>
<h3 id="-lua-">添加一些 Lua 文件来储存不同的模块常量</h3>
<ul>
<li>Cocos2DConstants.lua 储存 <code>cc</code> 模块的常量</li>
<li>StudioConstants.lua 储存 <code>ccs</code> 模块的常量</li>
<li>GuiConstants.lua 储存 <code>ccui</code> 模块的常量</li>
<li>OpenglConstants.lua 储存 <code>gl</code> 模块的常量</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./cocos2d-x_v3.x_release_notes.html" class="navigation navigation-prev " aria-label="Previous page: Cocos2d-x v3.x 系列"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./cocos2d-x_v3.0_release_notes_en.html" class="navigation navigation-next " aria-label="Next page: Cocos2d-x v3.0 英文发布说明"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"disqus":{"shortName":"Cocos2d-x"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
