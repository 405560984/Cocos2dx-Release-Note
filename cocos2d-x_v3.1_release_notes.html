<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Cocos2d-x v3.1 中文发布说明 | Cocos2d-x 版本发布说明</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="./cocos2d-x_v3.1_release_notes_en.html" />
    
    
    <link rel="prev" href="./cocos2d-x_v3.0_release_notes_en.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="gitbook/style.css">


        
    <div class="book" data-level="2.3" data-basepath="." data-revision="1435215429636">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="cocos2d-x_release_notes.html">
            
                
                    <a href="./cocos2d-x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Cocos2d-x 版本发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="cocos2d-x_v3.x_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Cocos2d-x v3.x 系列
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="cocos2d-x_v3.0_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.0_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Cocos2d-x v3.0 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="cocos2d-x_v3.0_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.0_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Cocos2d-x v3.0 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="2.3" data-path="cocos2d-x_v3.1_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.1_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                         Cocos2d-x v3.1 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.4" data-path="cocos2d-x_v3.1_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.1_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                         Cocos2d-x v3.1 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.5" data-path="cocos2d-x_v3.2_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.2_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                         Cocos2d-x v3.2 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.6" data-path="cocos2d-x_v3.2_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.2_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                         Cocos2d-x v3.2 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.7" data-path="cocos2d-x_v3.3_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.3_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                         Cocos2d-x v3.3 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.8" data-path="cocos2d-x_v3.3_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.3_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                         Cocos2d-x v3.3 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.9" data-path="cocos2d-x_v3.4_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.4_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                         Cocos2d-x v3.4 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.10" data-path="cocos2d-x_v3.4_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.4_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                         Cocos2d-x v3.4 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.11" data-path="cocos2d-x_v3.5_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.5_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.11.</b>
                        
                         Cocos2d-x v3.5 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.12" data-path="cocos2d-x_v3.5_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.5_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.12.</b>
                        
                         Cocos2d-x v3.5 英文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.13" data-path="cocos2d-x_v3.6_release_notes.html">
            
                
                    <a href="./cocos2d-x_v3.6_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.13.</b>
                        
                         Cocos2d-x v3.6 中文发布说明
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.14" data-path="cocos2d-x_v3.6_release_notes_en.html">
            
                
                    <a href="./cocos2d-x_v3.6_release_notes_en.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.14.</b>
                        
                         Cocos2d-x v3.6 英文发布说明
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="cocos2d-x_v4.x_release_notes.html">
            
                
                    <a href="./cocos2d-x_v4.x_release_notes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Cocos2d-x v4.x 系列
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Cocos2d-x 版本发布说明</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_5">
                    
                        <h1 id="cocos2d-x-v31-">cocos2d-x v3.1 发布说明</h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>目录</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank">DocToc</a></em></p>
<ul>
<li><a href="#%E6%A6%82%E5%86%B5">概况</a></li>
<li><a href="#%E9%9C%80%E6%B1%82">需求</a><ul>
<li><a href="#%E7%8E%AF%E5%A2%83%E9%9C%80%E6%B1%82">环境需求</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E9%9C%80%E6%B1%82">编译需求</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C-testcpp">如何运行 TestCpp</a><ul>
<li><a href="#mac-osx-&amp;-ios">Mac OSX &amp; iOS</a></li>
<li><a href="#android">Android</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%A7%8B%E4%B8%80%E4%B8%AA%E6%96%B0%E6%B8%B8%E6%88%8F">如何开始一个新游戏</a></li>
</ul>
</li>
<li><a href="#v30-%E4%BA%AE%E7%82%B9">v3.0 亮点</a></li>
<li><a href="#%E7%BB%86%E8%8A%82">细节</a><ul>
<li><a href="#sprite3d">Sprite3D</a></li>
<li><a href="#%E6%8F%90%E5%8D%87%E4%BA%86shader%E5%AD%90%E7%B3%BB%E7%BB%9F">提升了Shader子系统</a></li>
<li><a href="#%E6%96%B0%E7%9A%84%E6%95%B0%E5%AD%A6%E5%BA%93">新的数学库</a></li>
<li><a href="#%E6%96%B0%E7%9A%84uivideoplayer">新的UIVideoPlayer</a></li>
<li><a href="#ui%E5%AF%BC%E8%88%AA">UI导航</a><ul>
<li><a href="#%E7%94%A8%E6%B3%95">用法</a></li>
<li><a href="#%E5%B1%80%E9%99%90">局限</a></li>
</ul>
</li>
<li><a href="#%E6%8F%90%E5%8D%87%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1">提升目录结构设计</a></li>
<li><a href="#%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%E4%BF%AE%E5%A4%8D">粒子系统修复</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96-api-%E5%8F%98%E6%9B%B4">其他 API 变更</a><ul>
<li><a href="#%E5%BC%83%E7%94%A8%E5%87%BD%E6%95%B0%E5%92%8C%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">弃用函数和全局变量</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="">概况</h1>
<ul>
<li>下载: <a href="http://cdn.cocos2d-x.org/cocos2d-x-3.1rc0.zip" target="_blank">http://cdn.cocos2d-x.org/cocos2d-x-3.1rc0.zip</a></li>
<li>完整更新日记: <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.1rc0/CHANGELOG" target="_blank">https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.1rc0/CHANGELOG</a></li>
<li><del>API参考手册: <a href="http://www.cocos2d-x.org/reference/native-cpp/V3.0/index.html" target="_blank">http://www.cocos2d-x.org/reference/native-cpp/V3.0/index.html</a></del></li>
<li>v3.0 发布说明: <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.0/docs/RELEASE_NOTES.md" target="_blank">v3.0 Release Notes</a></li>
</ul>
<h1 id="">需求</h1>
<h2 id="">环境需求</h2>
<ul>
<li>Android 2.3 及以上</li>
<li>iOS 5.0 及以上</li>
<li>OS X 10.7 及以上</li>
<li>Windows 7 及以上</li>
<li>Windows Phone 8 及以上</li>
<li>Linux Ubuntu 12.04 及以上</li>
<li><del>Browsers via Emscripten</del> 暂不支持</li>
</ul>
<h2 id="">编译需求</h2>
<ul>
<li>Xcode 4.6 及以上 for iOS or Mac</li>
<li>gcc 4.7 及以上 for Linux</li>
<li>gcc 4.7 和 ndk-r9 及以上 for Android</li>
<li>Visual Studio 2012 及以上 for Windows (win32)</li>
<li>Visual Studio 2012 及以上 for Windows Phone 8</li>
</ul>
<h2 id="-testcpp">如何运行 TestCpp</h2>
<h3 id="mac-osx--ios">Mac OSX &amp; iOS</h3>
<ul>
<li>进入 <code>cocos2d-x/build</code> 文件夹, 打开 <code>cocos2d_test.xcodeproj</code></li>
<li>在 Xcode 的 scheme toolbar 选择 <code>iOS</code> 或者 <code>OS X</code> 平台</li>
<li>点击 <code>run</code> 按钮</li>
</ul>
<h3 id="android">Android</h3>
<p>你可以运行一下示例...</p>
<p><strong>使用命令行：</strong></p>
<pre><code>$ cd cocos2d-x
$ ./setup.py
$ cd build
$ ./android-build.py cpp-empty-test -p 10
$ adb install cocos2d-x/tests/cpp-empty-test/proj.android/bin/CppEmptyTest-debug.apk
</code></pre><p>然后点击安卓设备上的程序运行测试例，<code>-p</code> 指定了 Android API 等级，cocos2d-x 支持 level10 以上。</p>
<p><strong>使用 Eclipse:</strong></p>
<pre><code>$ cd cocos2d-x
$ ./setup.py
$ cd build
$ ./android-build.py cpp-empty-test -p 10
</code></pre><p>然后</p>
<ul>
<li>把 cocos2d-x Android 项目导入 Eclipse 中，导入的路径是 <code>cocos/platform/android</code></li>
<li>把 <code>cpp-empty-test</code> Android 项目导入 Eclipse 中，导入的路径是 <code>tests/cpp-empty-test/proj.android</code></li>
<li>编译 <code>cpp-empty-test</code> Android 项目，然后运行即可</li>
</ul>
<h3 id="windows">Windows</h3>
<ul>
<li>进入 <code>cocos2d-x/build</code> 目录, 然后打开 <code>cocos2d-win32.vs2012.sln</code> 文件</li>
<li>选择 <code>cpp-empty-test</code> 作为启动项</li>
<li>点击运行按钮</li>
</ul>
<h3 id="linux">Linux</h3>
<pre><code>$ cd cocos2d-x/build
$ ./install-deps-linux.sh
$ cd ../..
</code></pre><p>然后</p>
<pre><code>$ mkdir build
$ cd build
$ cmake ../cocos2d-x
$ make -j4
</code></pre><p>运行</p>
<pre><code>$ cd bin/cpp-empty-test
$ ./cpp-empty-test
</code></pre><h2 id="">如何开始一个新游戏</h2>
<p>请参考: <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.1/README.md" target="_blank">ReadMe</a></p>
<h1 id="v30-">v3.0 亮点</h1>
<ul>
<li><code>Sprite3D</code>，一个用于渲染3D模型的新节点</li>
<li>提升了Shader子系统</li>
<li>新的，统一的数学库</li>
<li><code>ui::VideoPlayer</code>，一个用于播放视频的新节点</li>
</ul>
<h1 id="">细节</h1>
<h2 id="sprite3d">Sprite3D</h2>
<p>cocos2d-x v3.0 将<code>Node</code>的变换矩阵将2x3替换为4x4。这个特性允许你在一个3d空间内转换任意的节点。</p>
<p><code>Sprite3D</code>允许开发者在cocos2d中渲染一个3d模型。因为cocos2d-x拥有了4x4的变换矩阵，所以它能够实现<code>Sprite3D</code>在x，y，z轴上的移动，缩放和旋转。</p>
<p>它的API是非常类似于<code>Sprite</code>的:</p>
<pre><code class="lang-c++"><span class="hljs-comment">//v3.1仅支持波前文件格式</span>
<span class="hljs-keyword">auto</span> sprite3d = Sprite3D::create(<span class="hljs-string">"mymodel.obj"</span>);

<span class="hljs-comment">//如果.obj文件中没有指定材质，你可以重写它：</span>
<span class="hljs-keyword">auto</span> sprite3d = Sprite3D::create(<span class="hljs-string">"mymodel.obj"</span>, <span class="hljs-string">"texture.png"</span>);

<span class="hljs-comment">//因为Sprite3D就是一个普通的节点，所以你可以像其他节点一样添加到场景中</span>
scene-&gt;addChild(sprite3d);
sprite3d-&gt;setRotation3D(Vec3(x,y,z));
</code></pre>
<h2 id="shader">提升了Shader子系统</h2>
<p>为了支持<code>Sprite3D</code>，我们重构了shader子系统，对2D和3D的而言，shader系统将会更强大也更易于使用。</p>
<p>在v3.0中，<code>GLProgram</code>类即用于控制 <em>OpenGL program</em> (shader)，同时也用于shader状态(uniforms变量，attributes变量)。</p>
<p>这样的设计有个很大的局限：为了增加或者移除一个attribute或者uniform，你不得不去继承<code>GLProgram</code>子类。</p>
<p>在3.1中，我们将shader状态从shader中分离出来，我们添加了<code>GLProgramState</code>用于控制uniforms变量和attributes变量。</p>
<p>API如下:</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> glprogram = GLProgram::create(...);

<span class="hljs-comment">// 它将会自动解析所有的attributes和uniforms</span>
<span class="hljs-comment">// 由glprogram使用，它将会填充glprogramstate dictionary</span>
<span class="hljs-keyword">auto</span> glprogramstate = GLProgramState::create( glprogram );

<span class="hljs-comment">// 为Vec2设置一个uniform（Int, Texture, Vec3, Vec4, Mat4都支持）</span>
glprogramstate-&gt;setUniformVec2(<span class="hljs-string">"u_my_uniform"</span>, Vec2(x,y));
<span class="hljs-comment">// 用一个回调来设置它</span>
glprogramstate-&gt;setUniformCallback(<span class="hljs-string">"u_my_uniform"</span>, [](Uniform*uniform){
    <span class="hljs-comment">// do something</span>
});

<span class="hljs-comment">// 设置一个属性</span>
glprogramstate-&gt;setVertexAttribPointer(<span class="hljs-string">"a_my_attrib"</span>, <span class="hljs-number">4</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">0</span>, vertex);
<span class="hljs-comment">// 用一个回调来设置它</span>
glprogramstate-&gt;setVertexAttribCallback(<span class="hljs-string">"a_my_attrib"</span>, [](VertexAttrib*attrib){
    <span class="hljs-comment">// do something</span>
 });
</code></pre>
<p>通过使用这个API就可以改变一个<code>Sprite3D</code>的效果，而不需要去子类化任何cocos2d的类</p>
<p>示例:</p>
<ul>
<li>Outline / Shadow / Glow effects</li>
<li>Multi-texturing effects</li>
<li>Sepia, Grey 或者 other color effects</li>
<li>等等</li>
</ul>
<p>完整示例请参考 <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.1rc0/tests/cpp-tests/Classes/ShaderTest/ShaderTest2.cpp" target="_blank">Shader - Sprite</a> 和 <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.1rc0/tests/cpp-tests/Classes/ShaderTest/ShaderTest.cpp" target="_blank">Shader - Basic</a>。</p>
<h2 id="">新的数学库</h2>
<p>cocos2d-x v1.0仅支持2D的特性，所以它使用了一个2x3的变换矩阵来进行操作。</p>
<p>在cocos2d-x v2.0中，我们添加了OpenGL ES 2.0支持（不再基于OpenGL矩阵操作）。所以使用了一个<a href="https://github.com/Kazade/kazmath" target="_blank">Kazmath</a>数学库来替换openGL ES 1.0的功能。Kazmath在引擎内部使用，绝大多数的情况下，开发者并不会调用Kazmath的API。</p>
<p>在cocos2d-x v3.0中，我们重构了渲染器，同时也希望提供更多的Kazmath API给开发者使用。</p>
<p>在cocos2d-x v3.1中，由于<code>Sprite3D</code>需要我们提供更多的API给开发者，这是Kazmath库所不能提供的，而cocos2d-x内部拥有多个数学库是没有意义的。</p>
<p>那么问题来了:</p>
<ul>
<li>部分代码使用旧的2D数学库</li>
<li>部分代码使用Kazmath</li>
<li>部分代码使用专门的数学代码</li>
</ul>
<p>我们的目标是在cocos2d-x只使用一个数学库，但有以下需求：</p>
<ul>
<li>易于使用，易于维护</li>
<li>成熟的，被反复证明过的</li>
<li>如果可能的话，使用C++语言</li>
</ul>
<p>所以我们选择了<a href="http://gameplay3d.org/" target="_blank">GamePlay3D</a>数学库，我们做了小幅的修改，添加了一些cocos2d-x数学代码。</p>
<p>如何使用它呢:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// vector2</span>
Vec2 vec2(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>);
Vec2 other2(<span class="hljs-number">30</span>,<span class="hljs-number">40</span>);
<span class="hljs-keyword">auto</span> ret = vec2.cross(other2);
<span class="hljs-keyword">auto</span> ret2 = vec2 + other2;
<span class="hljs-keyword">auto</span> ret3 = vec3 * scalar;

node-&gt;setPosition(vec2);

<span class="hljs-comment">// vector3</span>
Vec3 vec3(<span class="hljs-number">30</span>,<span class="hljs-number">40</span>,<span class="hljs-number">50</span>);
node-&gt;setPosition3D(vec3);

<span class="hljs-comment">// vector4</span>
Vec4 vec4 = Vec4::ZERO;

<span class="hljs-comment">// Matrix 4x4</span>
<span class="hljs-keyword">auto</span> identity = Mat4::IDENTITY;
node-&gt;setNodeToParentTransform(identity);
</code></pre>
<p>好消息是旧的API仍然是有效的，因为我们使用<code>typeof</code>方法将旧的类和结构体定义到新的数学库类型上。</p>
<h2 id="uivideoplayer">新的UIVideoPlayer</h2>
<p>v3.1有一个新的<code>Node</code>用于播放视频，API是：</p>
<pre><code class="lang-c++"><span class="hljs-comment">//VideoPlayer在“experimental”命名空间下，因为目前它只支持iOS和Android，而且我们将会修改它的API</span>
<span class="hljs-keyword">auto</span> videoPlayer = cocos2d::experimental::ui::VideoPlayer::create();
videoPlayer-&gt;setContentSize(Size(x,y));
videoPlayer-&gt;setURL(<span class="hljs-string">"http://example.com/video.mp4"</span>);  
<span class="hljs-comment">//你也可以像下面这样播放一个本地视频：</span>
<span class="hljs-comment">//videoPlayer-&gt;setFileName("filepath/video.mp4");</span>
videoPlayer-&gt;play();
</code></pre>
<h2 id="ui">UI导航</h2>
<p>3.1支持UI控件的焦点导航，这对OTT制造商是非常有用的。</p>
<h3 id="">用法</h3>
<p>支持屏幕中拥有3个水平排布的窗口，我们可以这么定义：</p>
<pre><code class="lang-c++">HBox(widget1, widget2, widget3)
</code></pre>
<p>如果你想要定位到<code>widget1</code>，那么就调用</p>
<pre><code class="lang-c++">widget1-&gt;setfocused(<span class="hljs-keyword">true</span>)
</code></pre>
<p>如果你想要移动焦点到下一个窗口，那么就调用</p>
<pre><code class="lang-c++">widget1-&gt;findNextFocusedWidget(Widget::FocusDirection::RIGHT, _firstFocusedWidget);
</code></pre>
<p>当你的焦点在<code>widget3</code>的时候，如果你调用</p>
<pre><code class="lang-c++">widget3-&gt;findNextFocusedWidget(Widget::FocusDirection::RIGHT, _firstFocusedWidget);
</code></pre>
<p>，焦点仍然会停留，只有当你调用了<code>HBox-&gt;setLoopFocus()</code>，焦点才会重新移动到<code>widget1</code>。</p>
<p><strong>注意：</strong></p>
<p>HBox和VBox可以通过任意的方式嵌套，所有的窗口都可以被添加到HBox/VBox如果你想要它们晚一点被定位的话。</p>
<p>当焦点从一个窗口移动到另一个的时候，它将会触发一个<em>focus event</em>。你可以添加以下的代码来处理这些事件。</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> eventListener = EventListenerFocus::create();
eventListener-&gt;onFocusChanged = CC_CALLBACK_2(UIFocusTestBase::onFocusChanged, <span class="hljs-keyword">this</span>);
eventDispatcher-&gt;addEventListenerWithFixedPriority(_eventListener, <span class="hljs-number">1</span>);
</code></pre>
<p>onFocusChanged回调函数中，当窗口失去焦点的时候，我们把它的颜色改成白色的，当窗口得到焦点的时候，我们把它的颜色改成红的。当焦点切换的时候，你可以添加更复杂的动画。</p>
<pre><code class="lang-c++"><span class="hljs-keyword">void</span> UIFocusTestBase::onFocusChanged(cocos2d::ui::Widget *widgetLostFocus, cocos2d::ui::Widget *widgetGetFocus)
{
    Layout *getLayout = <span class="hljs-keyword">dynamic_cast</span>&lt;Layout*&gt;(widgetGetFocus);
    <span class="hljs-keyword">if</span> (!getLayout &amp;&amp; widgetGetFocus &amp;&amp; widgetGetFocus-&gt;isFocusEnabled()) {
        widgetGetFocus-&gt;setColor(Color3B::RED);
    }
    Layout *loseLayout = <span class="hljs-keyword">dynamic_cast</span>&lt;Layout*&gt;(widgetLostFocus);
    <span class="hljs-keyword">if</span> (!loseLayout &amp;&amp; widgetLostFocus &amp;&amp; widgetLostFocus-&gt;isFocusEnabled()) {
        widgetLostFocus-&gt;setColor(Color3B::WHITE);
    }
}
</code></pre>
<p>更多使用信息请参考<a href="https://github.com/cocos2d/cocos2d-x/blob/v3/tests/cpp-tests/Classes/UITest/CocoStudioGUITest/UIFocusTest/UIFocusTest.cpp" target="_blank">这个文件</a>。</p>
<h3 id="">局限</h3>
<p>只支持两种类型的布局，<code>HORIZONTAL</code>和<code>VERTICAL</code>，这意味着我们不能使用Scrollview和PageView作为一个基础布局。</p>
<p>如下布局：</p>
<pre><code class="lang-c++">HBox(VBox, ScrollView(HBox(VBox, VBox, VBox)))
VBox(HBox, PageView(VBox(HBox,HBox))))
</code></pre>
<p>目前暂不支持，我们将会在cocos2d-x v3.2中实现它。</p>
<p>如果你想要实现在scrollview中焦点的移动，你可以使用一个普通的VBox或者HBox布局元素，然后调用<code>setFocusEnabled(true/false)</code>手动来跳过不想要的窗口。</p>
<h2 id="">提升目录结构设计</h2>
<p>在v3.0中我们重新组织了cocos2d-x的目录结构。可惜我们没有时间及时完成它。</p>
<p>在v3.1中我们完成了目录结构的重新组织，现在它是这样子的：</p>
<pre><code>cocos/: 包含cocos2d.cpp和其他编译文件
cocos/2d/: 包含基本的nodes，2d nodes和Node，Scene，Sprite之类的对象.
cocos/3d/: 包含3d nodes和Sprite3D之类的对象
cocos/audio/: 声音和音乐相关对象
cocos/math/: 数学库相关对象
cocos/platform/: 指定平台对象
cocos/renderer/: Renderer, Texture2D, Render Commands等GPU相关对象.
cocos/physcis/: 物理相关对象
cocos/network/: 网络相关对象
cocos/editor-support/: 第三方编辑器文件格式
</code></pre><h2 id="">粒子系统修复</h2>
<p>cocos2d-x v3.0及更早的版本中，<code>ParticleSystem</code>有一个Y-flipped参数计算错误的bug。</p>
<p>我们在v3.1中修复了这个bug。但是问题是修复这个bug会破坏向后兼容性。</p>
<p>为了可以更简单地过渡到v3.1，我们创建了一个工具用来修复破坏的粒子系统文件。怎样使用它呢：</p>
<pre><code># 修复破坏的.plist文件
# 会生成一个被转换文件的备份
$ cocos/tools/particle/convert_YCoordFlipped.py *.plist
</code></pre><h1 id="-api-">其他 API 变更</h1>
<h2 id="">弃用函数和全局变量</h2>
<p>TODO: 旧的数学API</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./cocos2d-x_v3.0_release_notes_en.html" class="navigation navigation-prev " aria-label="Previous page: Cocos2d-x v3.0 英文发布说明"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./cocos2d-x_v3.1_release_notes_en.html" class="navigation navigation-next " aria-label="Next page: Cocos2d-x v3.1 英文发布说明"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"disqus":{"shortName":"Cocos2d-x"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
